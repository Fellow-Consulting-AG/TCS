<mx:Window 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:control="gadget.control.*" 
	xmlns:MyValidate="gadget.util.*"
	width="{getWindowWidth()}"
	height="{getWindowHeight()}"
	resizable="false"
	title="{i18n._('GLOBAL_PREFERENCES')}" 
	creationComplete="init();"
	showFlexChrome="false" transparent="true" systemChrome="none" xmlns:s="library://ns.adobe.com/flex/spark">
	<!--CRO 12.01.2011 -->
	<mx:Script>
		<![CDATA[
			import com.adobe.images.PNGEncoder;
			
			import gadget.chatclient.CRMXAMPPConnection;
			import gadget.control.CalculatedField;
			import gadget.dao.Database;
			import gadget.dao.PreferencesDAO;
			import gadget.dao.SimpleTable;
			import gadget.i18n.i18n;
			import gadget.service.RightService;
			import gadget.service.UserService;
			import gadget.sync.WSProps;
			import gadget.sync.task.LoginCRM;
			import gadget.util.CacheUtils;
			import gadget.util.FeedUtils;
			import gadget.util.FileBrowse;
			import gadget.util.ImageUtils;
			import gadget.util.SodUtils;
			import gadget.util.StringUtils;
			import gadget.util.Utils;
			import gadget.window.WindowManager;
			
			import ilog.calendar.google.AuthenticationService;
			import ilog.calendar.google.CalendarService;
			import ilog.calendar.google.GServiceEvent;
			
			import mx.collections.ArrayCollection;
			import mx.containers.VBox;
			import mx.controls.Alert;
			import mx.controls.CheckBox;
			import mx.controls.ComboBox;
			import mx.controls.Label;
			import mx.events.CloseEvent;
			import mx.events.DataGridEvent;
			import mx.graphics.codec.PNGEncoder;
			import mx.utils.Base64Encoder;
			import mx.utils.StringUtil;
			import mx.validators.Validator;
			
			import org.igniterealtime.xiff.data.IQ;
			import org.igniterealtime.xiff.data.disco.ItemDiscoExtension;
			import org.purepdf.pdf.ArabicLigaturizer;
			
			
			public var mainWindow:MainWindow;
			
			[Bindable] private var preferences:Object;
			[Bindable] protected var user:Object;	
			private var defaultSelected:ArrayCollection = new ArrayCollection();
			private static const TASK_NAME:String = "gadget.sync.task::Incoming";
			private static const TASK_NAME_INCOMMING:String = "gadget.sync.incoming::";
			
			private var timerChanged:Boolean = false;
			private var editStatus:Boolean = false;
			private var addRemoveEntityTransaction:Boolean = false;
			
			private var cache:CacheUtils = new CacheUtils("right");
			private var trxCache:CacheUtils=	new CacheUtils("Transaction_DAO")
			private var mapconnectInfo:Object = {use_sso:"use_sso",company_sso_id:"company_sso_id",sodhost:"sodhost",sodlogin:"sodlogin",sodpass:"sodpass",
				sync_startup:"sync_startup",syn_interval:"syn_interval",tech_username:"tech_username",tech_password:"tech_password"}
			private var mapInterface:Object = {interface_style:"interface_style",pdf_header:"pdf_header",background_color:"background_color",pdf_Page_Size:"pdf_Page_Size"}
			private var mapOption:Object = {editableList:"editableList",showDebug:"showDebug",predefined_filters:"predefined_filters",window_resize:"window_resize",
				start_at_login:"start_at_login",enable_google_calendar:"enable_google_calendar",enable_feed:"enable_feed",enable_favorite:"enable_favorite",enable_important:"enable_important",
				hide_sso_tech_user:"hide_sso_tech_user",enable_home_task:"enable_home_task",ms_exchange_enable:"ms_exchange_enable",netbreeze_tab:"netbreeze_tab",
				usegzip:"usegzip",enable_check_conflict:"enable_check_conflict",cvs_separator:"cvs_separator",log_files:"log_files",log_fileName:"log_fileName",
				important_length:"important_length",recent_filter:"recent_filter",enable_fuzzy:"enable_fuzzy",enable_convert_lead:"enable_convert_lead",enable_dashboard:"enable_dashboard",
				enable_daily_agenda:"enable_daily_agenda",enable_application_update:"enable_application_update"}
			private var mapAutoConfig:Object ={config_url:"config_url"}
			
			private var loader:Loader = new Loader(); 
			private var _fieldKey:String;
			
			private function init():void{
				//			var buttons:ArrayCollection = new ArrayCollection();
				//			buttons.addItem({label: "Cancel", icon:ImageUtils.cancelIcon}); 
				//			buttons.addItem({label: "Save changes", icon: ImageUtils.acceptIcon});
				//			buttonbardetail.dataProvider = buttons;
				//			buttonbardetail.addEventListener(ItemClickEvent.ITEM_CLICK, handleButtonBar);
				previewAvatar();
				
				preferences = Database.preferencesDao.read();
				if (!StringUtils.isEmpty(preferences.background_color))
					winTitleBarColor.selectedColor = preferences.background_color;
				else
					winTitleBarColor.selectedColor = 0xEEEEEE;
				
				prefTitleBar.setStyle('backgroundColor',winTitleBarColor.selectedColor);
				loadIMData();
				sodhost.setFocus();
				enabledTransactions();
				enabledFeed();
				interfaceStyle();
				disableChildTabNavigator();
				//CRO bug fixing 92 20.11.2011
				pdfPageSize();
				//----------------------------
				var sel:String = preferences.cvs_separator;
				if(sel== null || sel == ''){
					sel = ',';
				}
				cboSeparator.selectedIndex = CalculatedField.getComboSelectedIndex(cboSeparator,sel);
				important_length.selectedIndex = CalculatedField.getComboSelectedIndex(important_length,preferences.important_length);
				recent_filter.selectedIndex = CalculatedField.getComboSelectedIndex(recent_filter,preferences.recent_filter);
				
				// hide user interface tab
				var hide_user_interface:Boolean = Database.preferencesDao.getBooleanValue(PreferencesDAO.HIDE_USER_INTERFACE) as Boolean;				
				if(hide_user_interface){
					tabNavigator.removeChildAt(2);
				}
				
				// #310: Change request - Diversey sales - Prefernces - Connection Informations
				// set diable synchronization interval
				var disable_synchronization_interval:Boolean = Database.preferencesDao.getBooleanValue(PreferencesDAO.DISABLE_SYNCHRONIZATION_INTERVAL) as Boolean;				
				synchronization_interval.enabled = !disable_synchronization_interval;
				
				// set diable crm ondemand url
				var disable_crm_ondemand_url:Boolean = Database.preferencesDao.getBooleanValue(PreferencesDAO.DISABLE_CRM_ONDEMAND_URL) as Boolean;				
				sodhost.enabled = !disable_crm_ondemand_url;
				//-----340 vm init window size ---//
				
				this.systemManager.stage.addEventListener(KeyboardEvent.KEY_DOWN,keyDown);
				hideSSOTechUser(Database.preferencesDao.isHideSSOTechUser());

				cboFeedHistory.addEventListener(Event.CHANGE, function(e:Event):void {
					var day:int = (e.currentTarget as ComboBox).selectedItem.data;
					if(day != -1) {
						Alert.show("Are you sure to delete feed history.", "", 3, getParrent(), function(e:CloseEvent):void {
							if(e.detail == Alert.YES) {
								Database.feedHistoryDAO.deleteFeedHistoryByDay(day);
							}
						});
					}
				});
				
				initDataReportAdmin();
			}
			
			[Bindable] private var _dataProviderReportAdmin:ArrayCollection;
			private function initDataReportAdmin():void {
				var report:Object = Database.reportAdminDao.first();
				if(report != null) {
					txtType.text = report.type;
					txtPath.text = report.report_path;
					auditor.text = report.auditor?report.auditor:"";
					var childReport:ArrayCollection = new ArrayCollection(Database.reportAdminChildDao.fetch());
					_dataProviderReportAdmin = childReport.length > 0 ? childReport : new ArrayCollection([{report_name: null, report_code: null}]);
				}else {
					_dataProviderReportAdmin = new ArrayCollection([{report_name: null, report_code: null}]);
				}
			}
			
			private function enabledReportAdminSave():void {
				if(UserService.getCustomerId() == UserService.DIVERSEY) {
					var report:Object = new Object();
					report.type = txtType.text;
					report.report_path = txtPath.text;
					report.auditor = auditor.text;
					Database.begin();
					Database.reportAdminDao.insert(report);
					Database.reportAdminChildDao.delete_all();
					for each(var childReport:Object in _dataProviderReportAdmin) {
						if(!StringUtils.isEmpty(childReport.report_name) && !StringUtils.isEmpty(childReport.report_code)) {
							Database.reportAdminChildDao.insert(childReport);
						}
					}
					Database.commit();
				}
			}
			
			// Define event listener for the itemEditEnd event.
			private function itemEditEnd(event:DataGridEvent):void {
				
				var itemEdit:TextInput = (event.currentTarget as DataGrid).itemEditorInstance as TextInput;				
				if(event.rowIndex == _dataProviderReportAdmin.length - 1 && event.columnIndex == 1 && StringUtil.trim(itemEdit.text) != "") {
					_dataProviderReportAdmin.addItem({report_name: null, report_code: null});
				}
				
			}
			
			private function browserForOpen():void {
				try {
					var file:File = new File();
					file.browseForOpen("Please, select report admin file", [new FileFilter("Execute File(*.exe)", "*.exe;")]);
					file.addEventListener(Event.SELECT, function(event:Event):void {
						txtPath.text = (event.target as File).nativePath;
					});
				} catch (err:Error) {
					trace("Failed: ", err.message);
				}
			}
			
			private function getParrent():Preferences {
				return this;
			}
			
			private function keyDown(evt:KeyboardEvent):void {
				if (evt.charCode == Keyboard.ESCAPE) {
					this.close();
				}
			}
			private function disableChildTabNavigator():void {
				/*if(tabNavigator.getChildren().length==7){
				/*var hide_user_signature:Boolean = Database.preferencesDao.getBooleanValue(PreferencesDAO.HIDE_USER_SIGNATURE);
				if(UserService.JD!=UserService.getCustomerId()) 
				tabNavigator.removeChildAt(6);
				else if(hide_user_signature)
				tabNavigator.removeChildAt(6);  /**
				// move signature from preference to MenuBar Tool/Signature.
				// tabNavigator.removeChildAt(6);
				}*/
				
				//add or delete netbreeze
				addOrDeleteTab(Database.preferencesDao.getValue("netbreeze_tab", 0)== 0,netBreeze);
				
				//add or delete ms exchange
				addOrDeleteTab(Database.preferencesDao.getValue("ms_exchange_enable", 0)== 0,microsoftExchange);
				
				
				addOrDeleteTab(Database.preferencesDao.getValue("enable_google_calendar", 0)== 0,googleCalendar);
				
				addOrDeleteTab(Database.preferencesDao.getValue(PreferencesDAO.ENABLE_FEED, 0)== 0,feedSetting);
				
				addOrDeleteTab(UserService.getCustomerId() != UserService.DIVERSEY, recportAdmin);
				
				
				
				//			if(tabNavigator.getChildren().length>=6){
				//				if (Database.preferencesDao.getValue("netbreeze_tab", 0) == 0) tabNavigator.removeChildAt(5);
				//			}
				
				//			if(tabNavigator.contains(microsoftExchange) && Database.preferencesDao.getValue("ms_exchange_enable", 0) == 0)){
				//				tabNavigator.removeChild(microsoftExchange);
				//			}
				
				//if(tabNavigator.getChildren().length >=8){
				//				if (Database.preferencesDao.getValue("ms_exchange_enable", 0) == 0) tabNavigator.removeChild(microsoftExchange);
				//}
				//			if (Database.preferencesDao.getValue("enable_google_calendar",0) == 0){
				//				try {
				//					tabNavigator.removeChild(googleCalendar);
				//				}catch(err:Error){
				//					//ignor error child has been deleted.
				//				}
				//			} 
				
			}
			
			
			private function addOrDeleteTab(isDelete:Boolean, childDisplay:Canvas):void{
				if(childDisplay==null){
					return;
				}
				if (isDelete){
					if(tabNavigator.contains(childDisplay)){
						tabNavigator.removeChild(childDisplay);
					}
				}else{
					if(!tabNavigator.contains(childDisplay)){
						tabNavigator.addChild(childDisplay);
					}
				}
				
			}	
			
			private function reload():void {
				spinnersMove.removeAllChildren();
				enabledTrans.removeAllChildren(); 
				enabledFeeds.removeAllChildren();
				filterTrans.removeAllChildren();
				advancedFilter.removeAllChildren();
				//syncActivities.removeAllChildren();
				//syncAttachments.removeAllChildren();
				readonlyEntities.removeAllChildren();
				authorizeDeletion.removeAllChildren();
				displayTrans.removeAllChildren(); 
				syncChildren.removeAllChildren();
				init();
				mainWindow.updateTransactions();
				mainWindow.refreshWindowLogo();
			}
			private function getWindowWidth():Number{
				
				if(Database.preferencesDao.getBooleanValue('window_resize')==1){
					return 1024;
				}else{
					return Number(Database.preferencesDao.getValue('window_width'));
				}
				
			}
			private function getWindowHeight():Number{
				if(Database.preferencesDao.getBooleanValue('window_resize')==1){
					return 600;
				}else{
					return Number(Database.preferencesDao.getValue('window_height'));
				}
				
			}
			private function loadIMData():void {
				//			imform.roomURL.text = preferences.im_room_url;
				//			imform.username.text = preferences.im_user;
				//			imform.password.text = preferences.im_password;
				//			autoSingIn.selected = preferences.im_auto_sing_in==0 ? false : true;
				
				//			var currentUser:Object = Database.currentUserDAO.getCurrentUser();
				//			var allusers:ArrayCollection = new ArrayCollection(Database.allUsersDao.selectAll());
				//			var users:ArrayCollection = new ArrayCollection();
				//			for each(var user:Object in allusers){
				//				if(user.Id != currentUser.id){
				//					users.addItem(user);
				//				}
				//			}
				//			
				//			feedCboUser.dataProvider = users;
				//			feedCboUser.labelField = "Alias";
				//			
				//			feedListAddedUser.dataProvider = Database.feedUserDAO.getFeedUsers();
				//			feedListAddedUser.labelField = "Alias";
				//			
				//			feedCboUserFilter();
			}	
			
			//		private function feedAddUser():void {
			//			if(feedCboUser.selectedItem == null){
			//				Alert.show("Please select a user to add","",4,this);
			//				return;
			//			}
			//			(feedListAddedUser.dataProvider as ArrayCollection).addItem(feedCboUser.selectedItem);
			//			feedCboUserFilter();
			//		}
			//			
			//		private function feedRemoveUser():void {
			//			var index:int = feedListAddedUser.selectedIndex;
			//			var dp:ArrayCollection = feedListAddedUser.dataProvider as ArrayCollection;
			//			dp.removeItemAt(index);
			//			feedCboUserFilter();
			//		}	
			//			
			//		private function feedCboUserFilter():void {
			//			var allusers:ArrayCollection = feedCboUser.dataProvider as ArrayCollection;
			//			allusers.filterFunction = filterItem;
			//			allusers.refresh();
			//			feedCboUser.dataProvider = allusers;
			//			feedCboUser.validateNow();
			//		}	
			//		
			//		private function filterItem(item:Object):Boolean {
			//			for each(var addedUser:Object in feedListAddedUser.dataProvider){
			//				if(item.Id == addedUser.Id){
			//					return false;
			//				}
			//			}
			//			return true;
			//		}
			
			/*
			private function handleButtonBar(event:ItemClickEvent):void{
			if(event.label == "Cancel"){
			this.close();
			if(refreshMainWindow){
			mainWindow.checkTips();
			mainWindow.updateTransactions();
			}
			}else if(event.label == "Save changes"){
			if(save())
			this.close();
			}
			}	*/
			
			private function pdfPageSize():void{
				if("Landscape" == preferences.pdf_Page_Size){
					landScapeRadio.selected = true;
				}else{
					portraitRadio.selected = true;
				}
			}		
			
			private function interfaceStyle():void{			
				if("icons"==preferences.interface_style){
					iconsRadio.selected=true;
				}else{
					tabsRadio.selected =true;
				}
			}	
			
			private function enabledTransactions():void{
				var listTransaction:ArrayCollection = Database.transactionDao.listTransaction();
				var row:int = 1;
				//var lenght:int = listTransaction.length;
				//var vBoxList:Array = new Array();
				//var vBox:VBox = new VBox();
				
				enabledTrans.addChild(createLabel('PREFERENCES_LABEL_TEXT_TRANSACTIONS'));		
				filterTrans.addChild(createLabel('PREFERENCES_LABEL_TEXT_SYNCHRONIZE_FILTER'));		
				advancedFilter.addChild(createLabel('PREFERENCES_LABEL_TEXT_SYNCHRONIZE_AVANCEDFILTER'));
				syncChildren.addChild(createLabel('PREFERENCES_LABEL_TEXT_SYNC_CHILDREN'));
				
				//syncActivities.addChild(createLabel('PREFERENCES_LABEL_TEXT_SYNC_ACTIVITIES'));			
				//syncAttachments.addChild(createLabel('PREFERENCES_LABEL_TEXT_SYNC_ATTACHMENTS'));
				
				readonlyEntities.addChild(createLabel('PREFERENCES_LABEL_TEXT_READ_ONLY'));
				authorizeDeletion.addChild(createLabel('Authorize Deletion'));
				displayTrans.addChild(createLabel('Display'));
				spinnersMove.addChild(createLabel(" "));
				
				//var disable_authorize_deletion:Boolean = Database.preferencesDao.getBooleanValue(PreferencesDAO.DISABLE_AUTORIZE_DELETION);
				//authorizeDeletion.enabled = !disable_authorize_deletion;
				for(var i:int = 0; i < listTransaction.length; i++){
					var transaction:Object = listTransaction[i];
					trace(transaction.entity);
					var spinnerEntity:Spinner = new Spinner();
					spinnerEntity.addEventListener(MouseEvent.CLICK, spinnerEntityClick);
					spinnerEntity.height = 25;
					spinnersMove.addChild(spinnerEntity);
					
					var checkBox:CheckBox = new CheckBox();
					checkBox.label = transaction.entity;
					checkBox.selected = transaction.enabled==0?false:true;
					// #311: hange request - Diversey sales - Prefernces
					checkBox.enabled = !transaction.entity_disable;
					
					checkBox.addEventListener(MouseEvent.CLICK, onClickCheckBox);
					checkBox.height = 25;
					
					//cboBox.dataProvider = Database.filterDao.listFiltersCriteria(transaction.entity);
					// 08/07
					//var listFilter:ArrayCollection = Database.filterDao.listFilters(transaction.entity);
					var cboBox:ComboBox = new ComboBox();
					var listFilter:ArrayCollection = Database.filterDao.listFiltersCriteria(transaction.entity);
					var dataProvider:ArrayCollection = filterConjunctionAndToDisplay(listFilter, transaction.entity);
					cboBox.dataProvider = dataProvider;
					cboBox.labelField = "displayName";
					cboBox.width = 230;				
					
					// #311: hange request - Diversey sales - Prefernces 
					cboBox.enabled = transaction.filter_disable == true ? false :  checkBox.selected;
					var objSelected:Object = getSelectionObject(dataProvider, transaction.filter_id);
					cboBox.selectedItem = objSelected;
					cboBox.height = 25;
					
					
					
					
					var chkDisplayTrans:CheckBox = new CheckBox();				
					//cbodisplayTrans.dataProvider = Database.transactionDao.advancedfilter;
					///cbodisplayTrans.labelField = "display";
					if(checkBox.selected==true){
						chkDisplayTrans.selected = transaction.display == 0 ? false :  true;
					}else{
						chkDisplayTrans.selected = checkBox.selected;		
					}
					chkDisplayTrans.enabled = checkBox.selected && checkBox.enabled;
					chkDisplayTrans.addEventListener(MouseEvent.CLICK, onChangeValue);
					chkDisplayTrans.height = 25;
					chkDisplayTrans.label = " ";
					// #311: hange request - Diversey sales - Prefernces 
					//cbodisplayTrans.selectedItem = getSelectionObject(Database.transactionDao.advancedfilter, transaction.advanced_filter);;
					
					var cboAdvancedFilter:ComboBox = new ComboBox();				
					cboAdvancedFilter.dataProvider = Database.transactionDao.advancedfilter;
					cboAdvancedFilter.labelField = "name";
					cboAdvancedFilter.width = 100;				
					
					// #311: hange request - Diversey sales - Prefernces 
					cboAdvancedFilter.enabled = transaction.filter_disable == true ? false :  checkBox.selected;				
					cboAdvancedFilter.selectedItem = getSelectionObject(Database.transactionDao.advancedfilter, transaction.advanced_filter);;
					cboAdvancedFilter.height = 25;
					
					
					var bntSynChild:Button = new Button();	
					bntSynChild.label = "Edit";
					bntSynChild.height = 25;
					bntSynChild.enabled = (transaction.sync_attachments_disable == true && transaction.sync_activities_disable == true)==true ? false :  checkBox.selected;		
					bntSynChild.toolTip = transaction.entity;
					bntSynChild.addEventListener(MouseEvent.CLICK,function (event:MouseEvent):void{
						//Popup windown for sync children
						var bnt:Button = event.currentTarget as Button;
						var syncChildreeWin:SyncChidrenWindow = new SyncChidrenWindow();
						syncChildreeWin.entity = bnt.toolTip;
						WindowManager.openModal(syncChildreeWin);
					});
					var subSyncList:Array = Database.subSyncDao.findByEntity(transaction.entity);
					bntSynChild.visible = subSyncList.length > 0? true:false;
					
					
//					var chkActivities:CheckBox = new CheckBox();
//					chkActivities.label = " ";
//					chkActivities.selected = transaction.sync_activities==null || transaction.sync_activities==0? false : true;		
//					chkActivities.visible = SodUtils.transactionProperty(transaction.entity).ws20act;
//					chkActivities.height = 25;
//					// #311: hange request - Diversey sales - Prefernces
//					chkActivities.enabled = transaction.sync_activities_disable == true ? false :  checkBox.selected;
					
//					var chkAttachment:CheckBox = new CheckBox();
//					chkAttachment.label = " ";
//					chkAttachment.selected = transaction.sync_attachments==null || transaction.sync_attachments==0? false : true;		
//					chkAttachment.visible = SodUtils.transactionProperty(transaction.entity).ws20att;
//					chkAttachment.height = 25;
//					// #311: hange request - Diversey sales - Prefernces
//					chkAttachment.enabled = transaction.sync_attachments_disable == true ? false :  checkBox.selected;
					
					var chkReadonly:CheckBox = new CheckBox();
					chkReadonly.label = " ";
					chkReadonly.selected = transaction.read_only==null || transaction.read_only==0? false : true;	
					chkReadonly.addEventListener(MouseEvent.CLICK, onChangeValue);
					chkReadonly.height = 25;
					// #311: hange request - Diversey sales - Prefernces
					chkReadonly.enabled = transaction.read_only_disable == true ? false :  checkBox.selected;		
					
					var chkAuthorizeDeletion:CheckBox = new CheckBox();
					chkAuthorizeDeletion.label = " ";
					chkAuthorizeDeletion.selected = transaction.authorize_deletion==null || transaction.authorize_deletion==0? false : true;	
					chkAuthorizeDeletion.addEventListener(MouseEvent.CLICK, onChangeValue);
					chkAuthorizeDeletion.height = 25;
					// #311: hange request - Diversey sales - Prefernces
					chkAuthorizeDeletion.enabled = transaction.authorize_deletion_disable == true ? false :  checkBox.selected;		
					
					// put object selected to array
					defaultSelected.addItem(objSelected);
					
					enabledTrans.addChild(checkBox);
					//displayNameTrans.addChild(textField);
					filterTrans.addChild(cboBox);
					advancedFilter.addChild(cboAdvancedFilter);
					syncChildren.addChild(bntSynChild);
					
					//syncActivities.addChild(chkActivities);
					//syncAttachments.addChild(chkAttachment);
					
					readonlyEntities.addChild(chkReadonly);
					authorizeDeletion.addChild(chkAuthorizeDeletion);
					displayTrans.addChild(chkDisplayTrans);
				}
			}
			
			private function enabledFeed():void {
				enabledFeeds.addChild(createLabel('PREFERENCES_LABEL_TEXT_TRANSACTIONS'));
				var feeds:ArrayCollection = Database.feedDAO.getFeeds();
				for each(var feed:Object in feeds){
					var checkBox:CheckBox = new CheckBox();
					checkBox.label = feed.entity;
					checkBox.selected = feed.enabled == 0 ? false : true;
					checkBox.height = 25;
					enabledFeeds.addChild(checkBox);
				}
			}	
			
			private function createLabel(text:String,fontWeight:String="bold"):Label{
				var label:Label = new Label();
				label.setStyle("fontWeight", fontWeight);
				label.text = i18n._(text);
				return label;
			}	
			
			
			
			private function spinnerEntityClick(e:MouseEvent):void{
				var targetButton:spark.components.Button = e.target as spark.components.Button;
				var spinner:Spinner = e.currentTarget as Spinner;
				var index:int = spinnersMove.getChildIndex(spinner);
				var numChild:int = spinnersMove.getChildren().length;
				if(targetButton.id == "incrementButton"){
					if(index > 1){
						enabledTrans.addChildAt(enabledTrans.removeChildAt(index), index - 1);
						filterTrans.addChildAt(filterTrans.removeChildAt(index), index - 1);
						//syncActivities.addChildAt(syncActivities.removeChildAt(index), index - 1);
						//syncAttachments.addChildAt(syncAttachments.removeChildAt(index), index - 1);
						readonlyEntities.addChildAt(readonlyEntities.removeChildAt(index), index - 1);
						displayTrans.addChildAt(displayTrans.removeChildAt(index), index - 1);
						editStatus = true;
					}
				}else if(targetButton.id == "decrementButton"){
					if(index < numChild - 1){
						enabledTrans.addChildAt(enabledTrans.removeChildAt(index), index + 1);
						filterTrans.addChildAt(filterTrans.removeChildAt(index), index + 1);
						//syncActivities.addChildAt(syncActivities.removeChildAt(index), index + 1);
						//syncAttachments.addChildAt(syncAttachments.removeChildAt(index), index + 1);
						readonlyEntities.addChildAt(readonlyEntities.removeChildAt(index), index + 1);
						displayTrans.addChildAt(displayTrans.removeChildAt(index), index + 1);
						editStatus = true;
					}
				}
			}
			
			private function filterConjunctionAndToDisplay(list:ArrayCollection, entity:String):ArrayCollection{
				var collection:ArrayCollection = new ArrayCollection();
				for each(var obj:Object in list){
					// || obj.id == "-2" || obj.id == "-3" || obj.id == "-4"
					//CRO 17.01.2011
					var filterName:String = obj.name;
					filterName = filterName.indexOf('GLOBAL') == -1 ? filterName : i18n._(filterName);
					obj.displayName = filterName.replace("{ENTITY}", Database.customLayoutDao.getPlural(entity));
					if (obj.type == 0 || obj.type == -1 || WSProps.isWS20filter(obj.type)) {
						collection.addItem(obj);
					}else if(obj.type>0){
						if(Database.criteriaDao.findCriterialWithConjunctionAnd(obj.id).length>0){
							collection.addItem(obj);
						}
					}
				}
				return collection;
			}
			
			private function getSelectionObject(list:ArrayCollection, id:String):Object{
				for each(var obj:Object in list){
					if(obj.type==id)
						return obj;
				}
				return list.length==0?null:list.getItemAt(0);
			}
			
			private function saveData():void {
				//CRO bug fixing 92 20.01.2011
				var pdfSize:String = portraitRadio.selected ? portraitRadio.value as String : landScapeRadio.value as String ;
				preferences.pdf_Page_Size = pdfSize;
				//-------------------------------
				preferences.sodhost = sodhost.text; 
				preferences.sodlogin = sodlogin.text; 
				preferences.sodpass = sodpass.text;
				preferences.config_url = configurl.text;				
				preferences.interface_style = iconsRadio.selected ? iconsRadio.value : tabsRadio.value;
				preferences.sync_startup = startupsync.selected ? 1 : 0;
				preferences.disable_gzip = disableGzip.selected ? 1 : 0;
				preferences.syn_interval = syn_interval.value;
				preferences.editableList = editableList.selected ? 1 : 0;
				preferences.showDebug = showDebug.selected ? 1 : 0;
				preferences.netbreeze_tab = netbreezeOpt.selected ? 1 : 0;
				preferences.log_files = logFile.selected ? 1 : 0;
				preferences.log_fileName=logFileName.text;
				preferences.window_resize = windowResize.selected ? 1 : 0;
				preferences.start_at_login = startAtLogin.selected ? 1 : 0;
				preferences.enable_favorite = chkFavorite.selected ? 1 : 0;
				preferences.enable_important = chkImportant.selected ? 1 : 0;
				preferences.enable_fuzzy = chkFuzzy.selected ? 1 : 0;
				preferences.enable_convert_lead = chkConvertLead.selected ? 1 : 0;
				preferences.enable_home_task= chkHomeTask.selected ? 1 : 0;
				
				preferences[PreferencesDAO.ENABLE_CUSTOM_LAYOUT] = chkCustLayout.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_LIST_LAYOUT] = chkListLayout.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_VIEW_LAYOUT] = chkViewLayout.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_FILTER] = chkFilterLayout.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_CONNECTION_INFORMATION] = chkConnection.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_TRANSACTION] = chkEnableTransaction.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_USER_INTERFACE] = chkUserInterface.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_OPTION] = chkOption.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_AUTO_CONFIGURATION] = chkAutoConfict.selected ? 1 : 0;			
				preferences[PreferencesDAO.ENABLE_FACEBOOK] = chkFacebook.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_LINKEDIN] = chkLinkedin.selected ? 1 : 0; 
				preferences[PreferencesDAO.ENABLE_FEED] = chkEnableFeed.selected ? 1 : 0; 
				preferences[PreferencesDAO.ENABLE_DASHBOARD] = chkDashboard.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_DAILY_AGENDA] = chkDailyAgenda.selected ? 1 : 0;
				preferences[PreferencesDAO.ENABLE_APPLICATION_UPDATE] = chkAppUpdate.selected ? 1 : 0;
				
				preferences.ms_url=ms_url.text;
				preferences.ms_user=ms_user.text;
				preferences[PreferencesDAO.HIDE_TECH_USER] = hideTechUser.selected?1:0;
				preferences.ms_password = ms_pwd.text;
				preferences.cvs_separator = cboSeparator.selectedItem==null?',':cboSeparator.selectedItem.data;
				preferences.tech_username = tech_username.text;
				preferences.tech_password = tech_password.text;
				preferences.important_length = important_length.selectedItem==null?'10':important_length.selectedItem.data;
				preferences.recent_filter = recent_filter.selectedItem==null?'10':recent_filter.selectedItem.data;
				
				// set start application at login
				Utils.setStartAtLogin(startAtLogin.selected);
				
				//Bug fixing 472 CRO
				//Open code 748 CRO
				preferences.use_sso = use_sso.selected ? 1 : 0;
				preferences.company_sso_id=company_sso_id.text;
				preferences.usegzip=usegzip.selected? 1 : 0;
				preferences.enable_check_conflict=enable_check_conflict.selected?1:0;
				preferences.background_color = "0x" + winTitleBarColor.selectedColor.toString(16);
				preferences.ms_exchange_enable = exchangeOpt.selected ? 1 : 0 ;
				preferences.enable_google_calendar = googleOpt.selected ? 1 : 0 ;
				if(!startupsync.selected && timerChanged){
					mainWindow.setTimerSyncInterval(syn_interval.value);
					
				}
				//				preferences.im_room_url = imform.roomURL.text;
				//				preferences.im_protocol = "rtmfp";
				//				preferences.im_user = imform.username.text;
				//				preferences.im_password = imform.password.text;
				//				preferences.im_auto_sing_in = autoSingIn.selected;
				Utils.suppressWarning(new ArrayCollection([preferences]));
				Database.preferencesDao.update(preferences);
				Database.preferencesDao.setValue(PreferencesDAO.PDF_HEADER,pdfHeaderText.text);
				Database.preferencesDao.setValue("predefined_filters",showPredefinedFilters.selected);
				
				Database.preferencesDao.setValue("gmail_username",txtGmailUsername.text);
				Database.preferencesDao.setValue("gmail_password",txtGmailPassword.text);
				//Database.preferencesDao.setValue("enable_google_calendar",googleCalendarOpt.selected ? 1 : 0);
				
				//CRO bug fixing 92 20.01.2011
				Database.preferencesDao.setValue(PreferencesDAO.PDF_SIZE,pdfSize);
				//----------------------------
				
				mainWindow.refreshWindowLogo();
				enabledTransactionSave();
				enabledFeedSave();
				enabledReportAdminSave();
				if(editStatus){
					mainWindow.updateTransactions();
				}	
				mainWindow.checkTips();
				
				//			Database.feedUserDAO.delete_all();
				//		 	Database.feedUserDAO.insertFeedUsers(feedListAddedUser.dataProvider as ArrayCollection);
				FeedUtils.refreshRooms();
				
				if( chkEnableFeed.selected ){
					mainWindow.chatClientControl.initData();
				}
				
				this.close();
			}
			
			private function save():Boolean {
				if(!hasSelectedTransactions()) return false;
				if(!hasSelectedDisplayTransactions()) return false;
				if (validate()){
					Utils.showLoadingProgressWindow(saveData, i18n._(StringUtils.SAVING_DATA_STR), i18n._(StringUtils.SAVING_PREF_STR));
					return false; 
				}else{
					//CRO.05.01.2011
					Alert.show(i18n._('PREFERENCES_ALERT_TEXT_THE_CONNECTION_URL_IS_INVALID'), i18n._('GLOBAL_INVALID'), Alert.OK, this);
					tabNavigator.selectedIndex = 1;
				}
				return false;
			}
			
			
			private function exportPref():void{
				//need translate
				Utils.showLoadingProgressWindow(exportConfiguration, "Exporting Data", "Exporting Data");
			}	
			private function importFromOOD(xml:XML, popoup:ImportFiledOOD=null):void{
				dialog = popoup;
				importConfig(xml,preferencesXMLList,mapValueWithControls,reload)
				
			}
			
			private function importPref():void{
				var tmpPreferences:Object = new Object();
				var username:String = '';
				var passwornd:String ='';
				if(use_sso.selected){
					username = tech_username.text;
					passwornd = tech_password.text;
				}else{
					username = sodlogin.text;
					passwornd = sodpass.text;
				}
				tmpPreferences.sodhost = sodhost.text;
				tmpPreferences.sodlogin = username;
				tmpPreferences.sodpass = passwornd;
				var impOOD:ImportFiledOOD = new ImportFiledOOD();
				impOOD.importFromOOD = this.importFromOOD;
				impOOD.importFromFile = importConfiguration;
				impOOD.tmpPreferences = tmpPreferences;
				WindowManager.openModal(impOOD);
				
				
				//importConfiguration();			
			}	
			private function hasSelectedDisplayTransactions():Boolean {
				var vBoxChildList:Array = displayTrans.getChildren();
				var vBoxChildListFilterTrans:Array = filterTrans.getChildren();
				var childListFilterAdvanced:Array = advancedFilter.getChildren();
				if(vBoxChildListFilterTrans.length == 0){ Alert.show(i18n._('PREFERENCES_ALERT_TEXT_YOU_HAVE_TO_CHECK_AT_LEAST_ONE_ENTITY')); return false; }		
				for(var i:int = 1; i < vBoxChildList.length; i++){				
					var checkBox:CheckBox =  vBoxChildList[i] as CheckBox;
					var cboBox:ComboBox = vBoxChildListFilterTrans[i] as ComboBox;
					if(cboBox.selectedItem == null) continue;
					if(checkBox.selected==true){
						return true;
					}
				}
				Alert.show(i18n._('You have to check display at least one entity.'),prefTitleBar.title, Alert.OK, this); 
				return false;
			}
			private function hasSelectedTransactions():Boolean {
				var vBoxChildList:Array = enabledTrans.getChildren();
				var vBoxChildListFilterTrans:Array = filterTrans.getChildren();
				var childListFilterAdvanced:Array = advancedFilter.getChildren();
				if(vBoxChildListFilterTrans.length == 0){ Alert.show(i18n._('PREFERENCES_ALERT_TEXT_YOU_HAVE_TO_CHECK_AT_LEAST_ONE_ENTITY')); return false; }		
				for(var i:int = 1; i < vBoxChildList.length; i++){				
					var checkBox:CheckBox =  vBoxChildList[i] as CheckBox;
					var cboBox:ComboBox = vBoxChildListFilterTrans[i] as ComboBox;
					if(cboBox.selectedItem == null) continue;
					if(checkBox.selected==true){
						return true;
					}
				}
				Alert.show(i18n._('PREFERENCES_ALERT_TEXT_YOU_HAVE_TO_CHECK_AT_LEAST_ONE_ENTITY'),prefTitleBar.title, Alert.OK, this); 
				return false;
			}
			
			private function enabledTransactionSave():void {
				
				var transactions:Object = new Object;
				for each(var t:Object in Database.transactionDao.listTransaction()){
					transactions[t.entity] = t.read_only;
				}
				
				var vBoxChildList:Array = enabledTrans.getChildren();
				//var vBoxChildListDisplayName:Array = displayNameTrans.getChildren();
				var vBoxChildListFilterTrans:Array = filterTrans.getChildren();
				var childListFilterAdvanced:Array = advancedFilter.getChildren();
				if(vBoxChildListFilterTrans.length == 0){ Alert.show(i18n._('PREFERENCES_ALERT_TEXT_YOU_HAVE_TO_CHECK_AT_LEAST_ONE_ENTITY')); return; }
				Database.begin();
				if(addRemoveEntityTransaction){
					resetLastSyn_Date(TASK_NAME_INCOMMING + "FieldManagementService");
					resetLastSyn_Date(TASK_NAME_INCOMMING + "ReadPicklist");
					resetLastSyn_Date(TASK_NAME_INCOMMING + "PicklistService");
					resetLastSyn_Date(TASK_NAME_INCOMMING + "ReadCascadingPicklists");
				}
				for(var i:int = 1; i < vBoxChildList.length; i++){				
					var checkBox:CheckBox =  vBoxChildList[i] as CheckBox;
					//var textField:TextInput = vBoxChildListDisplayName[i] as TextInput;
					//var chkActivities:CheckBox = syncActivities.getChildAt(i) as CheckBox;
					//var chkAttachment:CheckBox = syncAttachments.getChildAt(i) as CheckBox;
					var chkReadonly:CheckBox = readonlyEntities.getChildAt(i) as CheckBox;
					var chkAuthorizeDeletion:CheckBox = authorizeDeletion.getChildAt(i) as CheckBox;
					var chkDisplay:CheckBox = displayTrans.getChildAt(i) as CheckBox;
					var cboBox:ComboBox = vBoxChildListFilterTrans[i] as ComboBox;
					var cboAdvance:ComboBox = childListFilterAdvanced[i];
					if(cboBox.selectedItem == null) continue;
					var enabled:int = 0;
					var transaction:Object = new Object();
					if(checkBox.selected==true){
						enabled = 1;
					}
					
					transaction.entity = checkBox.label;
					transaction.enabled = enabled;
					//transaction.display_name = textField.text;
					transaction.filter_id = cboBox.selectedItem.type;
					//transaction.sync_activities = chkActivities.selected;
					//transaction.sync_attachments = chkAttachment.selected;
					transaction.read_only = chkReadonly.selected == true? 1:0;
					transaction.authorize_deletion = chkAuthorizeDeletion.selected == true? 1:0;
					transaction.rank = i;
					transaction.display = chkDisplay.selected;
					transaction.advanced_filter = cboAdvance.selectedItem.type;
					changeDefaultSelectedUpdateSyn(cboBox.selectedItem);
					Database.transactionDao.update(transaction);
					clearRightCache(transactions, transaction.entity, transaction.read_only);
					//clear transaction bug#319
					clearTransactionCache(transaction.entity);
					RightService.deleteRightsCatch(transaction.entity);
				}
				Database.commit();
			}
			
			private function enabledFeedSave():void {
				var vBoxChildList:Array = enabledFeeds.getChildren();
				Database.begin();
				for(var i:int = 1; i < vBoxChildList.length; i++){
					var feed:Object = new Object();		
					var enabled:int = 0;
					var checkBox:CheckBox =  vBoxChildList[i] as CheckBox;
					if(checkBox.selected==true){
						enabled = 1;
					}
					feed.entity = checkBox.label;
					feed.enabled = enabled;
					feed.display_name = feed.entity;
					Database.feedDAO.updateFeed(feed);
				}
				Database.commit();
			}
			
			private function clearRightCache(transactions:Object, entity:String, readOnly:Boolean):void {
				if(transactions[entity] != readOnly){
					cache.put(entity,null);
				}
			}
			
			private function clearTransactionCache(entity:String):void{
				trxCache.put(entity,null);
				
			}	
			
			private function changeDefaultSelectedUpdateSyn(object:Object):void{
				if(!defaultSelected.contains(object)){
					var obj:Object = new Object();
					obj.task_name = TASK_NAME + object.entity
					obj.sync_date = "01/01/1970 00:00:00";
					obj.start_row = 0;
					obj.start_id = "";
					Database.lastsyncDao.update(obj);
				}
			}
			
			private function resetLastSyn_Date(taskName:String):void{
				var obj:Object = Database.lastsyncDao.find(taskName);
				if(obj) {
					obj.sync_date = "01/01/1970 00:00:00";
					Database.lastsyncDao.update(obj);
				}
			}			
			
			
			
			private function testConnection():void {
				//CRO 05.01.2011
				if(!validate()){ Alert.show(i18n._('PREFERENCES_ALERT_TEXT_THE_CONNECTION_URL_IS_INVALID'), i18n._('GLOBAL_INVALID'), Alert.OK, this); return}
				testConnectionBtn.enabled = false;
				waitConnectionEnable(testConnectionWait, true);
				
				var tmpPreferences:Object = new Object();
				tmpPreferences.sodhost = sodhost.text;
				tmpPreferences.sodlogin = sodlogin.text;
				tmpPreferences.sodpass = sodpass.text;
				tmpPreferences.tech_username = tech_username.text;
				tmpPreferences.tech_password = tech_password.text;
				//Bug fixing 472 CRO
				//Open code for fixing bug 748 CRO
				tmpPreferences.use_sso= use_sso.selected
				tmpPreferences.company_sso_id=company_sso_id.text	
				var login:LoginCRM = new LoginCRM(testConnectionSuccess, testConnectionError);
				login.loginCRM(tmpPreferences);
				
			}
			
			private function testGmailConnection():void {
				//TODO: GMAIL TEST CONNECTION		
				waitConnectionEnable(testGmailConnectionWait, true);
				var calendarService:CalendarService = new CalendarService();
				calendarService.addEventListener(GServiceEvent.SERVICE_RESULT, calendarService_serviceResultHandler);			
				calendarService.setCredentials(txtGmailUsername.text, txtGmailPassword.text);
				calendarService.authenticationService.clientLogin();
			}
			
			private function calendarService_serviceResultHandler(event:GServiceEvent):void {			
				if (event.operation == AuthenticationService.LOGIN) {
					auth_completeHandler(event);
				}      
			}
			
			private function auth_completeHandler(event:GServiceEvent):void {				
				if (event.httpStatus == 200) {             
					testGmailConnectionBtn.enabled = true;
					waitConnectionEnable(testGmailConnectionWait, false);
					Alert.show(i18n._('PREFERENCES_ALERT_TEXT_CONNECTION_TEST_SUCCESSFUL'), i18n._('GLOBAL_TEST_CONNECTION'), Alert.OK, this);
				} else {
					testGmailConnectionBtn.enabled = true;
					waitConnectionEnable(testGmailConnectionWait, false);
					Alert.show(i18n._('PREFERENCES_ALERT_TEXT_CONNECTION_TEST_FAILED'),i18n._('GLOBAL_TEST_CONNECTION'), Alert.OK, this);
				}         
			}	
			
			private function testConnectionError(error:String, event:Event):void {
				testConnectionBtn.enabled = true;
				waitConnectionEnable(testConnectionWait, false);
				//CRO 05.01.2011
				Alert.show(i18n._('PREFERENCES_ALERT_TEXT_CONNECTION_TEST_FAILED') + "\n" + error, i18n._('GLOBAL_TEST_CONNECTION'), Alert.OK, this);
			}
			
			private function testConnectionSuccess(sessionId:String):void {
				testConnectionBtn.enabled = true;
				waitConnectionEnable(testConnectionWait, false);
				Alert.show(i18n._('PREFERENCES_ALERT_TEXT_CONNECTION_TEST_SUCCESSFUL'), i18n._('GLOBAL_TEST_CONNECTION'), Alert.OK, this);
			}
			
			private function waitConnectionEnable(customLinkBtn:CustomLinkButton, enable:Boolean):void {
				customLinkBtn.visible = enable;
				customLinkBtn.includeInLayout = enable;
			}	
			
			
			private function validate():Boolean {
				var validatorErrorArray:Array = Validator.validateAll([crmondemandURLValidator,feedPortValidator]);
				return (validatorErrorArray.length == 0);
			}
			
			private function exportConfiguration():void{
				var applicationObject:Object = Utils.getAppInfo();
				var configXml:XML = 
					<configuration>
						<application-name>{applicationObject.name}</application-name>
						<application-version>{applicationObject.version}</application-version>
						<prefs />	
						<transactions />
						<custom-layouts />
						<list-layouts />
						<view-layouts />
						<validationRules />
						<validation-rules_2 />
						<validation-rules_translator />
						<filters />
						<access_profiles/>
						<access_profiles_entrys/>
						<access_profiles_trans/>
						<role_services/>
						<role_services_avail_tab/>
						<role_services_layout/>
						<role_services_page/>
						<role_services_priv/>
						<role_services_sel_tab/>
						<role_services_trans/>
						<role_services_type/>
						<custom_records_type_trans/>
						<field_managements/>
						<field_translations/>
						<territorytree/>
						<depthstructuretree/>
						<filter_translations/>
						<report_admins/>
						<custom_headers/>
					</configuration>;
				
				for each(var obj:Object in Database.industryDAO.getDifferenceLanguage()) {
					var industiesXML:XML = new XML("<industries language='"+obj.language_code+"' />");
					for each(var industry:Object in Database.industryDAO.getIndustrylists(obj.language_code)) {
						if(industry.data && industry.label) {
							var industryXML:XML =
								<industry>
									<enable>{industry.enable}</enable>
									<display_name>{industry.data}</display_name>
									<sic_code>{industry.sic_code}</sic_code>
								</industry>
							industiesXML.appendChild(industryXML);
						}
					}
					configXml.insertChildAfter(configXml.child("application-version"), industiesXML);
				}
				
				for each(var pref:Object in Database.preferencesDao.getPrefs(false)){
					var isEnable:Boolean =true;
					var value:String = pref.value;
					if(value=="0"){
						value = "false";
					}else if(value=="1"){
						value = "true";
					}				
					if(value==null || value=="null") value = "";
					var xmlPref:XML = new XML("<pref key='" + pref.key + "'>" + value + "</pref>");
					if(mapconnectInfo[pref.key] != null){
						if(!chkConnection.selected) isEnable = false;
					}else if(mapInterface[pref.key] != null){
						if(!chkUserInterface.selected) isEnable = false;
					}else if(mapOption[pref.key] != null){
						if(!chkOption.selected) isEnable = false;
					}else if(mapAutoConfig[pref.key] != null){
						if(!chkAutoConfict.selected) isEnable = false;
					}else{
						
					}
					if(isEnable) configXml.elements("prefs")[0].appendChild(xmlPref);
					
				}
				
				
				var vBoxChildList:Array = enabledTrans.getChildren();
				//var vBoxChildListDisplayName:Array = displayNameTrans.getChildren();
				var listTransaction:ArrayCollection = Database.transactionDao.listTransaction();
				var vBoxChildListFilterTrans:Array = filterTrans.getChildren();
				var childAdvanFilter:Array = advancedFilter.getChildren();
				for(var i:int = 0; i < listTransaction.length; i++){
					// Preferences
					var index:int = i + 1;
					var checkBox:CheckBox =  vBoxChildList[index] as CheckBox;
					var cboAdvanced:ComboBox = childAdvanFilter[index];
					//var textField:TextInput = vBoxChildListDisplayName[i] as TextInput;
					var cboBox:ComboBox = vBoxChildListFilterTrans[index] as ComboBox;
					//var chkActivities:CheckBox = syncActivities.getChildAt(index) as CheckBox;
					//var chkAttachment:CheckBox = syncAttachments.getChildAt(index) as CheckBox;
					var chkReadonly:CheckBox = readonlyEntities.getChildAt(index) as CheckBox;
					var chkAuthorizeDeletion:CheckBox = authorizeDeletion.getChildAt(index) as CheckBox;
					var chkDisplay:CheckBox = displayTrans.getChildAt(index) as CheckBox;
					var entity:String = checkBox.label;
					
					// #311: hange request - Diversey sales - Prefernces
					if(chkEnableTransaction.selected){
					
					
						
						var transactionXml:XML = 
							<transaction>
								<id>{entity}</id>
								<enabled>{checkBox.selected.toString()}</enabled>
								<filter>{cboBox.selectedItem.type}</filter>
								<advanced_filter>{cboAdvanced.selectedItem.type}</advanced_filter>
								<filter-disable>{listTransaction.getItemAt(i).filter_disable?"true":"false"}</filter-disable>
								<default-filter>{listTransaction.getItemAt(i).default_filter==null?"":listTransaction.getItemAt(i).default_filter}</default-filter>								
								
								<read-only>{chkReadonly.selected.toString()}</read-only>
								<display>{chkDisplay.selected.toString()}</display>
								<read-only-disable>{listTransaction.getItemAt(i).read_only_disable?"true":"false"}</read-only-disable>
								<authorize-deletion>{chkAuthorizeDeletion.selected.toString()}</authorize-deletion>
								<authorize-deletion-disable>{listTransaction.getItemAt(i).authorize_deletion_disable?"true":"false"}</authorize-deletion-disable>
								<entity-disable>{listTransaction.getItemAt(i).entity_disable?"true":"false"}</entity-disable>
								<rank>{listTransaction.getItemAt(i).rank}</rank>
								<sync_order>{listTransaction.getItemAt(i).sync_order}</sync_order>
								<sync-children/>
							</transaction>;
						var listChildren:Array = Database.subSyncDao.findByEntity(entity);
						generateXML(transactionXml.elements("sync-children"),"child",listChildren);
						configXml.elements("transactions")[0].appendChild(transactionXml);
					} 
					
					if(chkCustLayout.selected){
						// Custom Layouts
						// entity, col, row, column_name, custom
						var layouts:ArrayCollection = Database.customLayoutDao.read(entity);
						var customLayoutXML:XML;
						for each(var layout:Object in layouts) {							
							customLayoutXML = 
								<custom-layout>
									<entity>{entity}</entity>
									<subtype>{layout.subtype}</subtype>
									<deletable>{layout.deletable}</deletable>
									<icon>{layout.custom_layout_icon}</icon>
									<color>{layout.background_color==null ? "0xEEEEEE":layout.background_color}</color>
									<layout-name>{layout.layout_name == null ? entity : layout.layout_name}</layout-name>
									<display-name>{layout.display_name == null ? entity : layout.display_name}</display-name>
									<display-name-plural>{layout.display_name_plural == null ? entity : layout.display_name_plural}</display-name-plural>
									<layout_depend_on>{layout.layout_depend_on == null ? "" : layout.layout_depend_on} </layout_depend_on>
									<conditions />
									<custom-layout-title>{layout.custom_layout_title}</custom-layout-title>
									<fields />
									<custom-fields />
									<sql-filter-criterias />
								</custom-layout>;						
							
							var fields:ArrayCollection = Database.layoutDao.selectLayout(entity, layout.subtype);
							var conditions:ArrayCollection = Database.customLayoutConditionDAO.list(entity, layout.subtype);
							
							if (fields.length>0){
								for each(var field:Object in fields){
									//var customField:Object = field.customField;
									//if(!customField) customField = new Object();
									var fieldXML:XML = 
										<field>
											<col>{field.col}</col>
											<row>{field.row}</row>
											<column-name>{field.column_name}</column-name>
											<custom>{field.custom==null?"":field.custom}</custom>
											<readonly>{field.readonly==null?"false":field.readonly}</readonly>
											<mandatory>{field.mandatory==null?"false":field.mandatory}</mandatory>
											<max_chars>{field.max_chars==null?"":field.max_chars}</max_chars>
																		
										</field>;
									
									// ---------------------------------------------
									customLayoutXML.elements("fields")[0].appendChild(fieldXML);
								}
								// configXml.elements("custom-layouts")[0].appendChild(customLayoutXML);
							}					
							if (conditions.length>0){
								for each(var condition:Object in conditions){
									var conditionXML:XML = <condition>
										<num>{condition.num}</num>
										<column-name>{condition.column_name}</column-name>
										<operator>{condition.operator==null?"":condition.operator}</operator>
										<param>{condition.params==null?"":condition.params}</param>
										</condition>;
									customLayoutXML.elements("conditions")[0].appendChild(conditionXML);
								}
								// configXml.elements("custom-layouts")[0].appendChild(customLayoutXML);
							}
							
							if (fields.length>0 || conditions.length>0){
								configXml.elements("custom-layouts")[0].appendChild(customLayoutXML);
							}

						}
						
						//Custom field
						var customFieldList:ArrayCollection = Database.customFieldDao.allCustomField(entity);
						if (customFieldList.length>0){
							for each(var customField1:Object in customFieldList){
								var customFieldXML:XML = <custom-field>
									<column-name>{checkNullValueNoEscape(customField1.column_name)}</column-name>
									<fieldName>{checkNullValueNoEscape(customField1.fieldName)}</fieldName>
									<displayName>{checkNullValueNoEscape(customField1.displayName)}</displayName>
									<fieldType>{checkNullValueNoEscape(customField1.fieldType)}</fieldType>
									<value>{checkNullValueNoEscape(customField1.value)}</value>
									<subtype>{checkNullValueNoEscape(customField1.subtype)}</subtype>
									<defaultValue>{checkNullValueNoEscape(customField1.defaultValue)=="1"?true:false}</defaultValue>
									<bindField>{checkNullValueNoEscape(customField1.bindField)}</bindField>
									<bindValue>{checkNullValueNoEscape(customField1.bindValue)}</bindValue>
									<parentPicklist>{checkNullValueNoEscape(customField1.parentPicklist)}</parentPicklist>
								    <entity>{checkNullValueNoEscape(customField1.entity)}</entity>
 									
									<fieldCopy>{checkNullValueNoEscape(customField1.field_copy)}</fieldCopy>
									<sumFieldName>{checkNullValueNoEscape(customField1.sum_field_name)}</sumFieldName>
									<sumEntityName>{checkNullValueNoEscape(customField1.sum_entity_name)}</sumEntityName>
									<relationId>{checkNullValueNoEscape(customField1.relation_id)}</relationId>
							
									<translators/>
									<territorytree/>
									<depthstructuretree/>
								</custom-field>	
								
								var field_translators:ArrayCollection = Database.customFieldTranslatorDao.selectFields(entity,customField1.column_name);
								for each(var trans:Object in field_translators){
									var translatorXML:XML = <translator>
										<languageCode>{checkNullValueNoEscape(trans.languageCode,"")}</languageCode>
										<displayName>{checkNullValueNoEscape(trans.displayName,"")}</displayName>
										<value>{checkNullValueNoEscape(trans.value,"")}</value>
										<bindValue>{checkNullValueNoEscape(trans.bindValue)}</bindValue>
										</translator>;
									customFieldXML.elements("translators")[0].appendChild(translatorXML);
								}
								
								customLayoutXML.elements("custom-fields")[0].appendChild(customFieldXML);
							}
						}
						
						// export sql_filter_criteria
						// {entity_src: "", list_name: "", entity_dest: "", column_name: "", operator: "", param: "", conjunction: "", columns: "", num: ""}
						var sqlFilterCriteria:ArrayCollection = new ArrayCollection(Database.sqlListDAO.fetch({entity_src: entity}));
						if (sqlFilterCriteria.length > 0){
							for each(var yCriteria:Object in sqlFilterCriteria){
								var yCriteriaXML:XML = <sql-filter-criteria>
									<entity_src>{checkNullValueNoEscape(yCriteria.entity_src)}</entity_src>
									<list_name>{checkNullValueNoEscape(yCriteria.list_name)}</list_name>
									<entity_dest>{checkNullValueNoEscape(yCriteria.entity_dest)}</entity_dest>
									<column_name>{checkNullValueNoEscape(yCriteria.column_name)}</column_name>
									<operator>{checkNullValueNoEscape(yCriteria.operator)}</operator>
									<param>{checkNullValueNoEscape(yCriteria.param)}</param>
									<conjunction>{checkNullValueNoEscape(yCriteria.conjunction)}</conjunction>
									<columns>{checkNullValueNoEscape(yCriteria.columns)}</columns>
									<num>{checkNullValueNoEscape(yCriteria.num)}</num>
								</sql-filter-criteria>
								
								customLayoutXML.elements("sql-filter-criterias")[0].appendChild(yCriteriaXML);
							}
						}		
						
						// ----------------------------------------------
						
												
					} // end custom layout
					if(chkListLayout.selected){
						// List Layout
						// entity, num, element_name				
						var entityListLayout:XML = 
							<list-layout>
								<entity>{entity}</entity>
								<fields />
							</list-layout>;
						var listsLayout:ArrayCollection = Database.columnsLayoutDao.fetchColumnLayouts(entity);
						for each(var listLayout:Object in listsLayout){
							var listLayoutXml:XML = 
								<field>
									<num>{listLayout.num}</num>
									<element-name>{listLayout.element_name}</element-name>
									<filter-type>{listLayout.filter_type}</filter-type>
								</field>;
							entityListLayout.elements("fields")[0].appendChild(listLayoutXml);
						}
						configXml.elements("list-layouts")[0].appendChild(entityListLayout);
					}
					if(chkViewLayout.selected){
						// View Layout
						// entity, num, element_name				
						var entityViewLayout:XML = 
							<view-layout>
								<entity>{entity}</entity>
								<fields />
							</view-layout>;
						var viewsLayout:ArrayCollection = Database.viewLayoutDAO.selectAll(entity);
						for each(var viewLayout:Object in viewsLayout){
							var viewLayoutXml:XML = 
								<field>
									<num>{viewLayout.num}</num>
									<element-name>{viewLayout.element_name}</element-name>
								</field>;
							entityViewLayout.elements("fields")[0].appendChild(viewLayoutXml);
						}
						configXml.elements("view-layouts")[0].appendChild(entityViewLayout);
					}
					
					
					
					// Validation Rule
					// entity, num, rule_name, field, operator, value, message
					var entityValidatetion:XML = 
						<validationRule>
							<entity>{entity}</entity>
							<fields />
						</validationRule>
					for each(var obj1:Object in Database.validationDao.selectEntity(entity)){
						var validationRuleXML:XML = 
							<field>
								<num>{obj1.num}</num>
								<rule-name>{obj1.rule_name}</rule-name>
								<field>{obj1.field}</field>
								<operator>{obj1.operator}</operator>
								<value>{obj1.value==null?"":obj1.value}</value>
								<message>{obj1.message}</message>
							</field>;
						entityValidatetion.elements("fields")[0].appendChild(validationRuleXML);
					}
					configXml.elements("validationRules")[0].appendChild(entityValidatetion);
					
					// -- valiadtion rule 2
					var validationRule:ArrayCollection = Database.validationRuleDAO.selectAll(entity);
					var entityValidatetion2:XML = 
						<validation-rule>
							<entity>{entity}</entity>
							<rules />
						</validation-rule>;
					if (validationRule.length > 0){
						for each(var objRule:Object in validationRule){
							var validationRuleXML2:XML = <rule>
								<ruleName>{checkNullValueNoEscape(objRule.ruleName)}</ruleName>
								<active>{checkNullValueNoEscape(objRule.active)=="1"?"true":"false"}</active>
								<message>{checkNullValueNoEscape(objRule.message)}</message>
								<errorMessage>{checkNullValueNoEscape(objRule.errorMessage)}</errorMessage>
								<value>{checkNullValueNoEscape(objRule.value)}</value>
								<orderNo>{checkNullValueNoEscape(objRule.orderNo)}</orderNo>
							</rule>;
							entityValidatetion2.elements("rules")[0].appendChild(validationRuleXML2);
						}
					}	
					configXml.elements("validation-rules_2")[0].appendChild(entityValidatetion2);
					
					//=== validator rule translator ==//
					var validationRuleTran:ArrayCollection = Database.validationRuleTranslotorDAO.selectAll(entity);
					var entityTran:XML = 
						<validation-translator>
							<entity>{entity}</entity>
							<translators />
						</validation-translator>;
					for each(var tran:Object in validationRuleTran){
						var validationTranXML:XML = <translator>
													<ruleName>{checkNullValueNoEscape(tran.ruleName)}</ruleName>
													<errorMessage>{checkNullValueNoEscape(tran.errorMessage)}</errorMessage>
													<languageCode>{checkNullValueNoEscape(tran.languageCode)}</languageCode>
												</translator>;
						entityTran.elements("translators")[0].appendChild(validationTranXML);
					}
					configXml.elements("validation-rules_translator")[0].appendChild(entityTran);
					
					if(chkFilterLayout.selected){
						
						var filters:ArrayCollection = Database.filterDao.listFiltersCriteria(entity);
						var filtersXML:XML = <filter>
								<entity>{entity}</entity>
							</filter>;
						for each(var filter:Object in filters){
							var filterFieldXML:XML = <field>
								<name>{filter.name}</name>
								<predefined>{filter.predefined==1?'true':'false'}</predefined>
								<type>{filter.type}</type>
								</field>;
							//id, num, column_name, operator, param, conjunction
							var filterCriterias:ArrayCollection = Database.criteriaDao.select(filter.id);
							for each(var criteria:Object in filterCriterias){
								
								var criteriaXML:XML = <criteria-field>
									<num>{criteria.num}</num>
									<column-name>{criteria.column_name==null?"":criteria.column_name}</column-name>
									<operator>{criteria.operator==null?"":criteria.operator}</operator>
									<param>{criteria.param==null?"":criteria.param}</param>
									<conjunction>{criteria.conjunction}</conjunction>							
								</criteria-field>;
								
								filterFieldXML.appendChild(criteriaXML);
							}
							filtersXML.appendChild(filterFieldXML);	
						}
						configXml.elements("filters")[0].appendChild(filtersXML); 
						
					}	//end enable filter
				}// end loop
				
				
				//-----------------access_profile-------------------------
				var accessProfiles:Array=Database.accessProfileServiceDao.fetch();
				generateXML(configXml.elements("access_profiles"),"access_profile",accessProfiles);
				var offset:Number=0;
				while(true){
					
					var accesProfilesEntry:Array=Database.accessProfileServiceEntryDao.selectAll('5000',String(offset));
					if(accesProfilesEntry==null || accesProfilesEntry.length<1){
						break;
					}
					var root:XMLList=configXml.elements("access_profiles_entrys");
					var tag:String="access_profiles_entrys_"+String(offset)+"_to_"+String(offset+5000);
					var xmlList:XML=<{tag}/>;
					root.appendChild(xmlList);
					generateXML(root.elements(tag),"access_profile_entry",accesProfilesEntry);
					offset=offset+5000;
					
				}
				
				
				var accesProfilesTrans:Array=Database.accessProfileServiceTransDao.fetch();
				generateXML(configXml.elements("access_profiles_trans"),"access_profile_tran",accesProfilesTrans);
				//-------------------roles_service------------------------------------------			
				var roles:Array = Database.roleServiceDao.fetch();
				generateXML(configXml.elements("role_services"),"role_service",roles);
				roles = Database.roleServiceAvailableTabDao.fetch();
				generateXML(configXml.elements("role_services_avail_tab"),"role_service_avail_tab",roles);
				roles = Database.roleServiceLayoutDao.fetch();
				generateXML(configXml.elements("role_services_layout"),"role_service_layout",roles);
				roles = Database.roleServicePageLayoutDao.fetch();
				generateXML(configXml.elements("role_services_page"),"role_service_page",roles);
				
				roles = Database.roleServicePrivilegeDao.fetch();
				generateXML(configXml.elements("role_services_priv"),"role_service_priv",roles);
				roles = Database.roleServiceSelectedTabDao.fetch();
				generateXML(configXml.elements("role_services_sel_tab"),"role_service_sel_tab",roles);
				roles = Database.roleServiceTransDao.fetch();
				generateXML(configXml.elements("role_services_trans"),"role_service_trans",roles);
				roles = Database.roleServiceRecordTypeAccessDao.fetch();
				generateXML(configXml.elements("role_services_type"),"role_service_type",roles);
				//----------------------Custome record type trans------------------------------
				var custRecordType:Array=Database.customRecordTypeTranslationsDao.fetch();
				generateXML(configXml.elements("custom_records_type_trans"),"custom_record_type_trans",custRecordType);
				//----------------------field management-------------------------------------
				var fieldManagement:Array=Database.fieldManagementServiceDao.fetch();
				generateXML(configXml.elements("field_managements"),"field_management",fieldManagement);
				//----------------------translation fields----------------------------------------
				var fieldsTranlation:Array=Database.fieldTranslationDataDao.fetch();
				generateXML(configXml.elements("field_translations"),"field_translation",fieldsTranlation);
				//---------------------- Territory Tree ---------------------------------------
				var territoryData:Array = Database.territoryTreeDAO.fetch();
				generateXML(configXml.elements("territorytree"),"territory",territoryData);
				//---------------------- Depthstructure Tree ----------------------------------------
				var depthstructureData:Array = Database.depthStructureTreeDAO.fetch();
				generateXML(configXml.elements("depthstructuretree"),"depthstructure",depthstructureData);
				//Filter Translation
				var filterData:Array=Database.customFilterTranslatorDao.fetch();
				generateXML(configXml.elements("filter_translations"),"filter_translation",filterData);				
				//---------------------- TCS Report Admin ----------------------------------------
				exportReportAdmin(configXml);
				exportCustomHeader(configXml);
				var f:File = new File();
				buttonbardetail.enabled = false;
				buttonsconfigure.enabled = false;
				f.addEventListener(Event.SELECT, function (event:Event):void{
					var file:File = event.currentTarget as File;
					if(!file.extension) file = File.applicationStorageDirectory.resolvePath(file.nativePath + ".xml"); // Bug #543
					var strStyle:String = "black";
					var showText:String = i18n._('PREFERENCES_STRING_FILE_SAVED_SUCCESSFULLY');
					if(file!=null){
						if(file.extension != null && file.extension.toLowerCase()=="xml"){
							var fileStream:FileStream = new FileStream();
							fileStream.open(file, FileMode.WRITE);
							var byteData : ByteArray = new ByteArray();
							byteData.writeUTFBytes(configXml.toXMLString());
							fileStream.writeBytes(byteData, 0, byteData.length);
							fileStream.close();
						} else {
							
							strStyle = "red";
							showText = i18n._('PREFERENCES_STRING_FILE_NAME_SHOULD_HAVE_XML_EXTENSION');
						}
					}
					buttonbardetail.enabled = true;
					buttonsconfigure.enabled = true;
					showStatus.setStyle("color", strStyle);
					showStatus.text = showText;
				});
				f.addEventListener(Event.CANCEL, cancelledFile);
				//CRO 05.01.2011
				f.browseForSave(i18n._('GLOBAL_SAVE'));
			}
			
			private function generateXML(rootElememt:XMLList,tag:String,list:Array):void{
				
				for each(var obj:Object in list){
					var rootEach:XML=<{tag}/>;
					for(var field:String in obj){
						var val:String="";
						if(obj[field] is Boolean){
							if(obj[field]){
								val = "1";
							}else{
								val = "0";
							}
						}else{
							val = obj[field];
						}
						
						if(val!=null && val.length>0){
							rootEach.appendChild(<{field}>{val}</{field}>);
						}				
					}
					
					rootElememt.appendChild(rootEach);
				} 
			}	
			
			private function exportReportAdmin(configXml:XML):void {
				//---------------------- TCS Report Admin ----------------------------------------
				if(UserService.getCustomerId() == UserService.DIVERSEY) {
					var report:Object = Database.reportAdminDao.first();
					if(report != null) {
						configXml.elements("report_admins")[0].appendChild(<report_path>{report.report_path}</report_path>);
						configXml.elements("report_admins")[0].appendChild(<type>{report.type}</type>);
						var reportAdminChildData:Array = Database.reportAdminChildDao.fetch();
						generateXML(configXml.elements("report_admins") , "report", reportAdminChildData);
					}
				}
			}
			
			private function exportCustomHeader(configXml:XML):void{
				var translates:Array = Database.customFieldTranslatorDao.fetch({"entity":"custom_header"});
				var headers:Array = new Array();
				for each(var obj:Object in translates){
					var header:Object =new Object();
					header.languageCode = obj.languageCode;
					header.fieldName=obj.fieldName;
					header.displayName=obj.displayName;
					headers.push(header);
				}
				generateXML(configXml.elements("custom_headers"),"custom_header",headers);
			}
			
			private function importConfiguration(impPopup:ImportFiledOOD):void{
				var file:File = new File();
				file.browseForOpen(i18n._('PREFERENCES_FILE_OPEN_FILE'), [new FileFilter("*.XML", "*.xml")]);
				buttonbardetail.enabled = false;
				buttonsconfigure.enabled = false;
				showStatus.text = "";
				file.addEventListener(Event.SELECT,function (event:Event):void{uploadFile(event,impPopup)});
				file.addEventListener(Event.CANCEL, cancelledFile);
				
			}
			
			private function cancelledFile(event:Event):void{
				buttonbardetail.enabled = true;
				buttonsconfigure.enabled = true;
				showStatus.text = "";
			}
			
			
			private function preferencesStatus(success:Boolean):void{
				buttonbardetail.enabled = true;
				buttonsconfigure.enabled = true;
				if(success){
					showStatus.setStyle("color", "black");
					showStatus.text = i18n._('PREFERENCES_TEXT_CONFIGURATION_SUCCESSFULLY_UPDATED');
				}else{
					showStatus.setStyle("color", "red");
					showStatus.text = i18n._('PREFERENCES_TEXT_CONFIGURATION_FILE_HAS_BAD_FORMAT');
				}				
			}
			
			private function preferencesXMLList(prefs:XMLList):void{
				for each(var pref:XML in prefs.pref){
					var value:String = pref.children()[0];
					var key:String = pref.@key;
					if(value==null || value.toString()=="null") value ="";
					
					if(Database.preferencesDao.fieldsCrypt[key]!=null){
						try{
							value = Utils.decryptPassword(value);
						}catch(e:Error){
							//it's old password(didn't encrypt)
							//nothing todo
						}
					}
					
					
					
					
					if(key=="sodhost"){
						sodhost.text = value;
					}else if(key == "sodlogin"){
						sodlogin.text = value;
					}else if(key == "sodpass"){
						sodpass.text = value;
						
					}else if(key == "sync_startup"){
						startupsync.selected = value=="true"? true : false;
					}else if(key == "disable_gzip"){
						disableGzip.selected = value=="true"? true : false;
					}else if(key == "interface_style"){
						if(value=="tabs"){
							tabsRadio.selected = true;
						}else if(value=="icon"){
							iconsRadio.selected = true;
						}
					}else if(key == "config_url"){
						configurl.text = value;
					}else if(key == "window_resize"){
						windowResize.selected = value=="true"?true:false;
					}else if(key=='usegzip'){
						usegzip.selected=value=="true"?true:false;
					}else if(key=='enable_check_conflict'){
						enable_check_conflict.selected=value=="true"?true:false;
					}else if(key == "ms_exchange_enable"){
						exchangeOpt.selected = value=="true"?true:false;
					}
						//Bug fixing 472 CRO 
						//Open code for fixing bug #478 CRO
					else if(key == "use_sso"){
						use_sso.selected = value=="true"? true : false;
					}else if(key == "company_sso_id"){
						company_sso_id.text = value;
					}else if(key == "start_at_login") {
						startAtLogin.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_FAVORITE) {
						chkFavorite.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_IMPORTANT) {
						chkImportant.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_FUZZY){
						chkFuzzy.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.HIDE_TECH_USER){
						hideTechUser.selected =value == "true" ? true : false; 
						hideSSOTechUser(hideTechUser.selected);
					}else if(key == PreferencesDAO.ENABLE_CONVERT_LAED){
						chkConvertLead.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_HOME_TASK){
						chkHomeTask.selected = value == "true" ? true :false;
					}else if(key == PreferencesDAO.ENABLE_CUSTOM_LAYOUT){
						chkCustLayout.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_LIST_LAYOUT){
						chkListLayout.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_VIEW_LAYOUT){
						chkViewLayout.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_FILTER){
						chkFilterLayout.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_CONNECTION_INFORMATION){
						chkConnection.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_TRANSACTION){
						chkEnableTransaction.selected= value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_USER_INTERFACE){
						chkUserInterface.selected= value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_OPTION){
						chkOption.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_AUTO_CONFIGURATION){
						chkAutoConfict.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_FACEBOOK) {
						chkFacebook.selected = value == "true" ? true : false;
					} else if(key == PreferencesDAO.ENABLE_LINKEDIN) {
						chkLinkedin.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_FEED){
						chkEnableFeed.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_DASHBOARD){
						chkDashboard.selected = value == "true" ? true : false;
					}else if(key == PreferencesDAO.ENABLE_APPLICATION_UPDATE){
						chkAppUpdate.selected = value == "true" ? true : false;
					} 
					
					
					
					
					
				}
			}	
			private static function buttonImportClick(list:ArrayCollection,wind:Window,xmlList:XMLList,prefsXMLList:Function=null,mapValueWithControls:Function=null,reload:Function=null):void{
				
				var user:String = "";
				var xmlCh:XML = new XML();
				var i:int=0;
				var rSelected:RadioButton=null;
				for each(var r:RadioButton in list){
					if(r.selected){
						rSelected=r;
						i = parseInt(rSelected.id);
						break;
					}
				}
				xmlCh = xmlList[i];
				Utils.showLoadingProgressWindow(function importPref():void{importConfig(xmlCh,prefsXMLList,mapValueWithControls,reload);}, "Importing Data","Importing Data");
				
				
			}
			private function uploadFile(event:Event,importPoupScrean:ImportFiledOOD):void{
				uploadXMLFile(event.target as File,importPoupScrean,preferencesStatus,preferencesXMLList,mapValueWithControls,reload);
				
			}
			[Embed(source='/assets/preferences.png')] [Bindable] public static var ttIcon:Class;
			private static var radioTcsUser:RadioButton = null;
			private static var radioSalePlaning:RadioButton = null;
			private static var dialog:Window = null;
			
			private static function dialogPopupSelectXML(xmlList:XMLList,prefsXMLList:Function=null,mapValueWithControls:Function=null,reload:Function=null):void{
				
				dialog = new Window();
				dialog.transparent = false;
				dialog.systemChrome = "none";
				dialog.width = 250;
				var wHeight:int = 60;
				dialog.resizable = false;
				dialog.setStyle("showFlexChrome","false");
				
				
				var canvas:Canvas = new Canvas();
				canvas.percentWidth = 100;
				canvas.percentHeight = 100;
				canvas.top = 0;
				canvas.bottom = 0;
				canvas.setStyle("styleName","main");
				
				var maiBox:VBox = new VBox();
				canvas.addChild(maiBox);
				maiBox.percentWidth = 100;
				maiBox.percentHeight = 100;
				
				var titleBar:TitleBar = new TitleBar();
				titleBar.icon = ttIcon;
				titleBar.title ="Select Importing Data";
				maiBox.addChild(titleBar);
				
				var vbox:VBox = new VBox();
				maiBox.addChild(vbox);
				vbox.setStyle("paddingLeft","40");
				
				var id:int = 0;
				var listRadio:ArrayCollection=new ArrayCollection();
				var alreadySelected:Boolean = false;
				for each(var xml:XML in xmlList){
					wHeight = wHeight + 30;
					var name :String = xml.@name;
					if(StringUtils.isEmpty(name)){
						name = "Configuration " + (id+1);
					}
					var hbox:HBox = new HBox();
					radioSalePlaning = new RadioButton();
					radioSalePlaning.label=name;
					radioSalePlaning.id = "" + id;
					id++;
					radioSalePlaning.groupName = "multiImport";
					
					if(xml.@defualt== "true" && alreadySelected == false){
						radioSalePlaning.selected = true;
						alreadySelected = true;
					}
					
					listRadio.addItem(radioSalePlaning);
					hbox.addChild(radioSalePlaning);
					vbox.addChild(hbox);
					
				}
				dialog.height = wHeight;
				if(listRadio.length>0 && alreadySelected==false){
					(listRadio.getItemAt(0) as RadioButton).selected=true;
				}
				
				hbox = new HBox();
				var buttonOk:mx.controls.Button = new mx.controls.Button();
				buttonOk.label ="Ok";
				buttonOk.addEventListener(MouseEvent.CLICK, function okClick():void{buttonImportClick(listRadio,dialog,xmlList,prefsXMLList,mapValueWithControls,reload);});			
				hbox.addChild(buttonOk);
				
				
				var btnCancel:mx.controls.Button = new mx.controls.Button();
				btnCancel.label ="Cancel";
				btnCancel.addEventListener(MouseEvent.CLICK, function okClick():void{dialog.close();;});
				hbox.addChild(btnCancel);
				
				vbox.addChild(hbox);
				
				
				dialog.addChild(canvas);
				WindowManager.openModal(dialog);
			}
			
			public static function uploadXMLFile(file:File,window:Window,prefsStatus:Function=null,prefsXMLList:Function=null,mapValueWithControls:Function=null,reload:Function=null):void{
				dialog = window;
				var stream:FileStream = new FileStream();			
				stream.open(file, FileMode.READ);
				var fileData:String = stream.readUTFBytes(stream.bytesAvailable);
				//trace(fileData);
				try{
					var xml:XML = new XML(fileData);
					var name:String = xml.name();
					
					if("configuration" == name){
						if(reload!=null) {
							// Mony need to translate
							Utils.showLoadingProgressWindow(function importPref():void{importConfig(xml,prefsXMLList,mapValueWithControls,reload);}, "Importing Data","Importing Data");
						}else {
							// load default gadget.xml
							importConfig(xml,prefsXMLList,mapValueWithControls,reload);
						}
					}else if("configurations" == name){
						var chl:XMLList = xml.children();
						if(chl != null && chl.length() == 1){
							xml = chl[0] as XML;
							if(reload!=null) {
								// Mony need to translate
								Utils.showLoadingProgressWindow(function importPref():void{importConfig(xml,prefsXMLList,mapValueWithControls,reload);}, "Importing Data","Importing Data");
							}else {
								// load default gadget.xml
								importConfig(xml,prefsXMLList,mapValueWithControls,reload);
							}
						}else if(chl.length()>1){
							if(reload!=null) {
								dialogPopupSelectXML(chl,prefsXMLList,mapValueWithControls,reload);					
							}else{
								var hasDefual :Boolean = false;
								for each (var xmlDefaule:XML in chl){
									if(xmlDefaule.@defualt =="true"){
										xml = xmlDefaule;
										hasDefual = true;
										break;
									}
								}
								if(hasDefual==false){
									xml = chl[0];
								}
								importConfig(xml,prefsXMLList,mapValueWithControls,reload);
							}
						}
					}
					
					
					
				}catch(e:Error){
					var messageStr:String = e.message;
					var errorStr:String = messageStr.substr(messageStr.indexOf(':') + 1, messageStr.length);
					Alert.show(errorStr, i18n._('PREFERENCES_ALERT_TITLE_ERROR_IMPORTING_XML_FILE'), Alert.OK, window,function():void{
						if(prefsStatus!=null) prefsStatus(false);
					});
					return;
				}
				stream.close();
				if(prefsStatus!=null) prefsStatus(true);			
			}
			
			
			
			private static function importConfig(xml:XML,prefsXMLList:Function=null,mapValueWithControls:Function=null,reload:Function=null):void{
				Utils.importConfig(xml,prefsXMLList,mapValueWithControls,reload,dialog);			
			}
			
			private static function commitObjects(dao:SimpleTable,xmlList:XMLList):void{
				Utils.commitObjects(dao,xmlList);
			}	
			
			
			
			private static function checkNullValue(value:Object,nullValue:String=""):String{
				return Utils.checkNullValue(value,nullValue);	
			}	
			
			private static function checkNullValueNoEscape(value:Object,nullValue:String=""):String{
				return Utils.checkNullValueNoEscape(value,nullValue);	
			}		
			
			private function mapValueWithControls(transactionObject:Object):void{
				var vBoxChildList:Array = enabledTrans.getChildren();
				var vBoxChildListFilterTrans:Array = filterTrans.getChildren();
				
				for(var i:int = 1; i < vBoxChildList.length; i++){				
					var checkBox:CheckBox =  vBoxChildList[i] as CheckBox;
					var cboBox:ComboBox = vBoxChildListFilterTrans[i] as ComboBox;
					//var chkActivity:CheckBox = syncActivities.getChildAt(i) as CheckBox;
					//var chkAttachment:CheckBox = syncAttachments.getChildAt(i) as CheckBox;
					var chkReadonly:CheckBox = readonlyEntities.getChildAt(i) as CheckBox;
					var chkDisplay:CheckBox = displayTrans.getChildAt(i) as CheckBox;
					// Check if tag id equal checkbox's label 
					if(checkBox.label == transactionObject.entity){
						checkBox.selected = transactionObject.enabled == 0? false : true;
						cboBox.selectedItem = getSelectionObject(cboBox.dataProvider as ArrayCollection, transactionObject.filter_id);
						//chkActivity.selected = transactionObject.sync_activities == 0? false : true;
						//chkAttachment.selected = transactionObject.sync_attachments == 0? false : true;
						chkReadonly.selected = transactionObject.read_only == 0? false : true;
						chkDisplay.selected = transactionObject.display == 0? false : true;
						return;
					}
				}
			}
			
			
			private function loadConfiguration():void{
				if(configurl.text==""){
					//CRO 05.01.2011
					Alert.show(i18n._('PREFERENCES_ALERT_TEXT_CONFIGURATION_URL_IS_EMPTY'), i18n._('GLOBAL_INVALID'), Alert.OK, this);
				}else{
					
					var request:URLRequest = new URLRequest();
					request.url = configurl.text;
					request.method = URLRequestMethod.GET;
					var loader:URLLoader = new URLLoader();
					loader.addEventListener(Event.COMPLETE, successHandler);
					loader.addEventListener(IOErrorEvent.IO_ERROR, errorHandler);
					try {
						loader.load(request);
					} catch (e:Error) {
						//VAHI diagnose problem with URL
						Alert.show(e.message, i18n._('PREFERENCES_ALERT_TITLE_INVALID_CONFIGURATION_URL'), Alert.OK, this);
					}
				}
			}
			
			private function successHandler(event:Event):void{
				//Mony need to translate
				//this.close();
				// Utils.showLoadingProgressWindow(function importPrefByUrl():void{importConfig(new XML((event.currentTarget as URLLoader).data));}, "Importing Data","Importing Data");
				//VAHI XXX HACK
				// Added close of preference window such that user sees that something happened
				// Also this forces an reopen of Preference window, else something can be mixed up there.
				// Certainly the preference window shall show some clever message AND adapt to ALL(sic!) changes loaded.
				
				var xml:XML = new XML((event.currentTarget as URLLoader).data);
				Utils.showLoadingProgressWindow(function importPref():void{importConfig(xml,null,null,reload);}, "Importing Data","Importing Data");
			}
			
			private function errorHandler(event:IOErrorEvent):void{
				var s:String = i18n._('PREFERENCES_STRING_ERROR') + " ";
				var error:String = event.text;
				var message:String = error.substr(error.indexOf(s) + s.length) + " " + i18n._('PREFERENCES_STRING_NOT_FOUND');
				Alert.show(message, i18n._('PREFERENCES_ALERT_TITLE_INVALID_URL'),Alert.OK, this);
			}
			
			private function setDefaultIcons():void {
				updateCustomLayoutDefaultIcons();			
			}
			
			private function setOracleIcons():void {
				updateCustomLayoutDefaultIcons(false);
			}
			
			private function setFieldLogo(fieldKey:String):void {
				var fileBrowse:FileBrowse = new FileBrowse(uploadFieldLogo,true,fieldKey);
				fileBrowse.show();
			}
			
			private function uploadFieldLogo(fileName:String, data:Object,fieldKey:String):void {
				//#5938 CRO
				var loader:Loader = new Loader();
				loader.loadBytes(data as ByteArray); 
				loader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(e2:Event):void{
					var base64En:Base64Encoder = getBase64Encoder(Utils.imageLoaded((e2.currentTarget as LoaderInfo).loader,Utils.getRation(data as ByteArray)));
					Database.preferencesDao.setValue(fieldKey, base64En.toString());
					mainWindow.refreshWindowLogo();
				});
				
				
			}
			
        	private function getBase64Encoder(data:Object):Base64Encoder {
				var base64En:Base64Encoder = new Base64Encoder();
				var bytes:ByteArray = new ByteArray();
				var bytData:ByteArray = data as ByteArray;
				bytData.position =0;
				bytData.readBytes(bytes, 0, bytData.length);
				base64En.encodeBytes(bytes,0,bytes.length);
				return base64En;
			}
			
			private function onChangeValue(e:Event):void{
				editStatus = true;
			}
			
			private function onClickCheckBox(e:MouseEvent):void{
				editStatus = true;
				addRemoveEntityTransaction = true;
				var checkbox:CheckBox = e.currentTarget as CheckBox;
				var index:int = enabledTrans.getChildIndex(checkbox);
				var status:Boolean = checkbox.selected;
				
				// #311: hange request - Diversey sales - Prefernces
				var cache:CacheUtils = new CacheUtils("Transaction_DAO");
				cache.unset(checkbox.label);
				var trans:Object = Database.transactionDao.find(checkbox.label);
				
				var cboBox:ComboBox = filterTrans.getChildAt(index) as ComboBox;
				var cboAdvancedFilter:ComboBox = advancedFilter.getChildAt(index) as ComboBox;
				cboBox.enabled = trans.filter_disable ? false : status;
				cboAdvancedFilter.enabled = trans.filter_disable ? false : status;
				var bntSyncChildren:Button = syncChildren.getChildAt(index) as Button;
				bntSyncChildren.enabled = trans.sync_activities_disable ? false : status;
				
				//var chkAct:CheckBox = syncActivities.getChildAt(index) as CheckBox;
				//chkAct.enabled = trans.sync_activities_disable ? false : status;
				//var chkAttachment:CheckBox = syncAttachments.getChildAt(index) as CheckBox;
				//chkAttachment.enabled = trans.sync_attachments_disable ? false : status;
				
				var dis:CheckBox = displayTrans.getChildAt(index) as CheckBox;
				dis.selected = status;
				dis.enabled = cboBox.enabled;
				var chkReadonly:CheckBox = readonlyEntities.getChildAt(index) as CheckBox;
				chkReadonly.enabled = trans.read_only_disable ? false : status;
				
			}
			
			private function updateCustomLayoutDefaultIcons(bDefault:Boolean = true):void {
				for each( var customLayout:Object in Database.customLayoutDao.readAll() ){
					if(customLayout.entity == "Activity"){
						switch(customLayout.subtype){
							case 0: customLayout.custom_layout_icon = bDefault ? 'activity' : 'activityTaskDefault'; break;
							case 1: customLayout.custom_layout_icon = bDefault ? 'activity' : 'activityAppointmentDefault'; break;
						}
					}else{
						if(customLayout.subtype == 0){
							switch(customLayout.entity){
								case "Account" : customLayout.custom_layout_icon = bDefault ? 'account' : 'accountDefault'; break;
								case "Asset" : customLayout.custom_layout_icon = bDefault ? 'asset' : 'assetDefault'; break;
								case "Contact" : customLayout.custom_layout_icon = bDefault ? 'contact' : 'contactDefault'; break;
								case "Opportunity" : customLayout.custom_layout_icon = bDefault ? 'opportunity' : 'opportunityDefault'; break;
								case "Product" : customLayout.custom_layout_icon = bDefault ? 'product' : 'productDefault'; break;
								case "Service Request" : customLayout.custom_layout_icon = bDefault ? 'service' : 'serviceDefault'; break;
								case "Campaign" : customLayout.custom_layout_icon = bDefault ? 'campaign' : 'campaignDefault'; break;
								case "Custom Object 1" : customLayout.custom_layout_icon = bDefault ? 'custom' : 'customDefault'; break;
								case "Lead" : customLayout.custom_layout_icon = bDefault ? 'lead' : 'leadDefault'; break;
								case "Custom Object 2" : customLayout.custom_layout_icon = bDefault ? 'custom2' : 'custom2Default'; break;
								case "Custom Object 3" : customLayout.custom_layout_icon = bDefault ? 'custom3' : 'custom3Default'; break;
								case "CustomObject7" : customLayout.custom_layout_icon = bDefault ? 'custom7' : 'custom7Default'; break;
								case "CustomObject14" : customLayout.custom_layout_icon = bDefault ? 'custom14' : 'custom14Default'; break;
								case "Territory" : customLayout.custom_layout_icon = bDefault ? 'territory' : 'territoryDefault'; break;
							}
						}
					}
					Database.customLayoutDao.update(customLayout);
				}
				Database.customLayoutDao.clearIconCache();
				mainWindow.navigator.removeAllChildren();
				mainWindow.updateTransactions();
			}
			
			private function onChangeSyncInterval(event:Event):void{
				var textInput:TextInput = event.currentTarget as TextInput;
				if(textInput.text!=""){
					syn_interval.value = int(textInput.text);
					timerChanged = true;
				}
			}
			
			
			private function hideSSOTechUser(isHide:Boolean):void{
				var show:Boolean = 	!isHide && use_sso.selected;
				lblTechUser.visible=show;
				lblTechUser.includeInLayout =show;
				techPwd.visible = show;
				techPwd.includeInLayout =show;
				techUser.visible = show;
				techUser.includeInLayout =show;
				ssoRule.visible = show;
				ssoRule.includeInLayout =show;
			}
			
			protected function createNetbreeze_clickHandler(event:MouseEvent):void
			{
				var user: Object = Database.userDao.read();
				//attention
				if(!user)
				{   //05.01.2011
					Alert.show(i18n._('PREFERENCES_ALERT_TEXT_SYNC_BEFORE_NETBREEZE'), i18n._('GLOBAL_INVALID'), Alert.OK, this);
					return;
				}
				var netbreezeUser: Object = {id: user.id, user_sign_in_id: user.user_sign_in_id, full_name: user.full_name, netbreeze_id:NetbreezeUserId.text};
				if(Database.netbreezeDao.findByUserId(netbreezeUser) != null)
				{
					Database.netbreezeDao.update(netbreezeUser);
				}else
					Database.netbreezeDao.insert(netbreezeUser)
				
			}
			[Bindable] public static var dataSeparator:ArrayCollection = new ArrayCollection([
				{label:",",data:","},
				{label:";",data:";"},
				{label:"Tab",data:"tab"}
			]);
			[Bindable] public static var dataImportant:ArrayCollection = new ArrayCollection([
				{label:"10",data:"10"},
				{label:"20",data:"20"},
				{label:"100",data:"100"},
				{label:"Unlimited",data:"unlimited"}
			]);
			[Bindable] public static var dataRecentFilter:ArrayCollection = new ArrayCollection([
				{label:"5",data:"5"},
				{label:"14",data:"14"},
				{label:"30",data:"30"}
			]);
			[Bindable] public static var dataFeedHistory:ArrayCollection = new ArrayCollection([
				{label:"",data:-1},
				{label:"All",data:0},
				{label:"1 day",data:1},
				{label:"1 Week",data:7},
				{label:"1 Month",data:30}
			]);
			private function initializeNewDB_clickHandler():void {
				var encrypt_DB_file:File = File.applicationDirectory.resolvePath(Database.getCustomDatabasePathFromFile() + "/" + Database.ENCRYPTED_DB_NAME);
				var db_file:File = File.applicationDirectory.resolvePath(Database.getCustomDatabasePathFromFile() + "/" + Database.DB_NAME);
				var current_db_file:File = encrypt_DB_file.exists? encrypt_DB_file:db_file;
				if(current_db_file.exists){
					Alert.show('Are you sure you want to initialize new database? \nYou will loose your local data.'," Delete Database", Alert.YES|Alert.NO, this, function(event:CloseEvent):void{
						if (event.detail==Alert.YES){
							close();
							mainWindow.crmGadget.initializeNewDB(current_db_file,mainWindow);
						}    	 
					});	
				}		
			}

			protected function btnSetAvatar_clickHandler(event:MouseEvent):void {
				var fileBrowse:FileBrowse = new FileBrowse(uploadAvatar,true, null, true);
				fileBrowse.show();
			}
			
			private function uploadAvatar(fileName:String, data:Object, imageType:String):void {
				var base64En:Base64Encoder = getBase64Encoder(data);
				var strEncoder:String = base64En.toString();
				CRMXAMPPConnection.getInstance().setAvatar(strEncoder, imageType);
				var currentUser:Object = Database.userDao.read();
				Database.userDao.update( {'Avatar':strEncoder}, {'id': currentUser.id} );
				previewAvatar();
				mainWindow.chatClientControl.reloadCurrentUser();
			}
			
			private function previewAvatar():void {
				var result:Array = Database.userDao.fetch();
				if( result.length > 0 ){
					var currentUser:Object = result[0];
					if( currentUser.Avatar ){
						var byteArray:ByteArray = ImageUtils.getByteArray(currentUser.Avatar);
						imgPreviewAvatar.source = byteArray;
					}else{
						imgPreviewAvatar.source = ImageUtils.noPhoto;
					}
				}
			}

			protected function btnGetAvatar_clickHandler(event:MouseEvent):void {
				var followings:Array = Database.feedUserDAO.fetch();
				for each(var following:Object in followings){
					CRMXAMPPConnection.getInstance().getAvatar(following.Id, mainWindow.chatClientControl );
				}
			}

		]]>
	</mx:Script>
	
	<mx:Style source="styles.css"/>
	<mx:Canvas styleName="main" left="0" top="0" width="100%" height="100%" right="0" bottom="0"><!--CRO 05.01.2011 PREFERENCES_TITLEBAR_TITLE_PREFERENCES = GLOBAL_PREFERENCES -->
		<control:TitleBar id="prefTitleBar" icon="@Embed(source='/assets/preferences.png')" title="{i18n._('GLOBAL_PREFERENCES')}"/>
		<mx:VBox top="40" left="16" right="16" bottom="16">
			<mx:TabNavigator id="tabNavigator" width="100%" height="100%" creationPolicy="all">
				
				<mx:Canvas width="100%" label="{i18n._('PREFERENCES_CANVAS_LABEL_CONNECTION_INFORMATION')}">
					
					<!--
					<mx:Accordion id="accordion" color="0x323232" left="10" right="10" borderStyle="none">
					<mx:VBox label="CRM OnDemand Setup">-->
					<mx:VBox width="100%">
						<mx:Form width="100%">
							<!--Bug fixing 472 CRO -->
							<!--Open code for fixing bug 748 CRO-->
							<mx:FormItem label="Use SSO" id="chkUseSSO">
								<mx:CheckBox id="use_sso" selected="{Database.preferencesDao.getValue('use_sso')==1? true:false}" change="{editStatus = true;company_sso_id.enabled=use_sso.selected}" click="hideSSOTechUser(hideTechUser.selected)" />									
							</mx:FormItem>
							<mx:FormItem label="Company SSO Id" id="ssocompId">
								<mx:TextInput id="company_sso_id" width="360" enabled="{use_sso.selected}" text="{Database.preferencesDao.getValue('company_sso_id')}" />
							</mx:FormItem> 
							<mx:FormItem label="{i18n._('PREFERENCES_FORMITEM_LABEL_CRM_ONDEMAND_URL')}">
								<mx:TextInput id="sodhost" width="360" text="{preferences.sodhost}"/>
							</mx:FormItem><!--CRO 05.01.2011-->
							<mx:FormItem label="{i18n._('GLOBAL_LOGIN')}">
								<mx:TextInput id="sodlogin" width="360" text="{preferences.sodlogin}"/>
							</mx:FormItem><!--CRO 05.01.2011-->
							<mx:FormItem label="{i18n._('GLOBAL_PASSWORD')}">
								<mx:TextInput displayAsPassword="true" id="sodpass" width="360" text="{preferences.sodpass}"/>
							</mx:FormItem>
							<mx:FormItem label="Technical User" id="lblTechUser" fontWeight="bold"  includeInLayout="true"/>
							<mx:HRule width="100%" id="ssoRule"  includeInLayout="true" />
							<mx:FormItem label="Tech. User name" id="techUser"  includeInLayout="true">
								<mx:TextInput id="tech_username" enabled="{preferences.enabled_technical_user==null? true : preferences.enabled_technical_user == 1? true : false}" width="360" text="{preferences.tech_username}" />
							</mx:FormItem>
							<mx:FormItem label="Tech. Password" id="techPwd"  includeInLayout="true">
								<mx:TextInput id="tech_password" enabled="{preferences.enabled_technical_user==null? true : preferences.enabled_technical_user == 1? true : false}" displayAsPassword="true" width="360" text="{preferences.tech_password}" />
							</mx:FormItem>
						</mx:Form>
						<!--
						<mx:Canvas width="100%">
						<mx:Button left="240" bottom="10" id="testConnectionBtn" label="{i18n._('PREFERENCES_TEST_CONNECTION')}" click="testConnection()"/>
						<mx:Button left="240" bottom="10" id="testCIconBtn" label="" icon="@Embed('/assets/preferences.png')"/>
						</mx:Canvas>
						-->
						
						<mx:HBox width="100%" horizontalAlign="center">
							<!--CRO 05.01.2011-->
							<mx:Button id="testConnectionBtn" label="{i18n._('GLOBAL_TEST_CONNECTION')}" click="testConnection()"/>
							<control:CustomLinkButton id="testConnectionWait" icon="{ImageUtils.synOkIcon}" label="" visible="false" includeInLayout="false"/>
						</mx:HBox>
						<mx:Canvas width="100%">
							<mx:VBox  left="16">
								<mx:CheckBox id="startupsync" label="{i18n._('PREFERENCES_CHECKBOX_LABEL_SYNCHRONIZE_ON_STARTUP')}" selected="{preferences.sync_startup==0?false:true}" />
								<mx:CheckBox id="disableGzip" label="{i18n._('PREFERENCES_CHECKBOX_LABEL_USE_COMPRESSION')}" selected="{preferences.disable_gzip==0?false:true}"  visible="false"/>
								<mx:HBox>
									<mx:Label text="{i18n._('PREFERENCES_LABEL_TEXT_SYNCHRONIZATION_INTERVAL')}" />
									<mx:HBox id="synchronization_interval" paddingLeft="0" paddingRight="0" horizontalGap="0" paddingBottom="10">
										<s:Spinner id="syn_interval" maximum="60" minimum="0" value="{preferences.syn_interval}" click="{timerChanged = true;}" />
										<mx:TextInput text="{syn_interval.value}" width="40" height="23" maxChars="2" restrict="0-9" change="onChangeSyncInterval(event);" />
									</mx:HBox>
								</mx:HBox>
							</mx:VBox>
						</mx:Canvas>							
					</mx:VBox>
					
					<!--
					<mx:VBox label="IM Setup">
					<control:IMForm id="imform" paddingTop="20"/>
					<mx:CheckBox paddingLeft="16" id="autoSingIn" label="Sing in on startup"/>
					</mx:VBox>
					</mx:Accordion>
					-->
					
				</mx:Canvas>
				
				<mx:Canvas label="{i18n._('PREFERENCES_CANVAS_LABEL_ENABLED_TRANSACTION')}" width="100%" height="100%">
					<!--<mx:Tile left="16" id="enabledTransTile"/>-->
					<mx:HBox left="16">
						<mx:VBox id="spinnersMove" horizontalAlign="center" />
						<mx:VBox id="enabledTrans" /> 
						<mx:VBox id="filterTrans" />
						<mx:VBox id="advancedFilter" />
						<mx:VBox id="syncChildren" horizontalAlign="center"/>
						<!--
						<mx:VBox id="syncActivities" horizontalAlign="center"/>						
						<mx:VBox id="syncAttachments" horizontalAlign="center"/>
						-->
						<mx:VBox id="readonlyEntities" horizontalAlign="center"/>
						<mx:VBox id="authorizeDeletion" horizontalAlign="center"/>
						<mx:VBox id="displayTrans" horizontalAlign="center"/>
					</mx:HBox>
				</mx:Canvas>
				<mx:Canvas label="{i18n._('PREFERENCES_CANVAS_LABEL_USER_INTERFACE')}" width="100%" height="100%">
					<!--<mx:Tile left="16" id="enabledTransTile"/>-->
					<mx:VBox left="16" width="100%">						
						<mx:VBox paddingTop="0" paddingBottom="0">
							<mx:HBox>
								<mx:Label width="150" text="{i18n._('PREFERENCES_LABEL_TEXT_SCREEN_LAYOUT')}" fontWeight="bold" fontSize="14"/>
								<mx:RadioButton id="iconsRadio" value="icons" label="{i18n._('PREFERENCES_RADIOBUTTON_LABEL_ICONS')}" groupName="userinterface" change="onChangeValue(event);" />
							</mx:HBox>	
							<mx:HBox paddingLeft="158">
								<mx:RadioButton id="tabsRadio" value="tabs" label="{i18n._('PREFERENCES_RADIOBUTTON_LABEL_TABS')}" groupName="userinterface" change="onChangeValue(event);" />
							</mx:HBox>	
						</mx:VBox>
						<mx:HRule width="100%"/>
						<mx:VBox paddingTop="7" paddingBottom="8">							
							<mx:HBox>
								<mx:Label width="150" text="{i18n._('PREFERENCES_LABEL_TEXT_ICONS_SET')}" fontWeight="bold" fontSize="14"/>
								<mx:Button label="{i18n._('PREFERENCES_BUTTON_LABEL_SET_DEFAULT_ICONS')}" click="setDefaultIcons()"/>
								<mx:Button label="{i18n._('PREFERENCES_BUTTON_LABEL_SET_ORACLE_ICONS')}" click="setOracleIcons()"/>
							</mx:HBox>
						</mx:VBox>
						<mx:HRule width="100%"/>
						<mx:VBox paddingTop="7" paddingBottom="10">
							<mx:HBox paddingBottom="8">
								<mx:Label width="150" text="{i18n._('PREFERENCES_LABEL_TEXT_PDF_HEADER')}" fontWeight="bold" fontSize="14"/>
								<mx:Label text="{i18n._('PREFERENCES_LABEL_TEXT_HEADER_TEXT')}"/>
								<mx:TextInput id="pdfHeaderText" text="{Database.preferencesDao.getValue(PreferencesDAO.PDF_HEADER)}"/>
							</mx:HBox>
							<mx:HBox paddingLeft="158">
								<mx:Button label="{i18n._('PREFERENCES_BUTTON_LABEL_SET_A_LOGO')}" click="setFieldLogo(PreferencesDAO.PDF_LOGO)"/>
								<mx:Button label="{i18n._('PREFERENCES_BUTTON_LABEL_REMOVE_LOGO')}" click="{Database.preferencesDao.setValue(PreferencesDAO.PDF_LOGO,null)}"/>
							</mx:HBox>
						</mx:VBox>
						<mx:HRule width="100%"/>
						<mx:VBox paddingTop="7" paddingBottom="10">
							<mx:HBox>
								<mx:Label width="150" text="{i18n._('PREFERENCES_LABEL_TEXT_WINDOW_TITLE')}" fontWeight="bold" fontSize="14"/>
								<mx:Button label="{i18n._('PREFERENCES_BUTTON_LABEL_SET_A_LOGO')}" click="setFieldLogo(PreferencesDAO.WINDOW_LOGO)"/>
								<mx:Button label="{i18n._('PREFERENCES_BUTTON_LABEL_REMOVE_LOGO')}" click="{Database.preferencesDao.setValue(PreferencesDAO.WINDOW_LOGO,null);mainWindow.refreshWindowLogo();}"/>
								<mx:Label width="180" text="{i18n._('PREFERENCES_LABEL_TEXT_BACKGROUND_COLOR')}" textAlign="right"/>
								<mx:ColorPicker id="winTitleBarColor" showTextField="true" />
							</mx:HBox>
						</mx:VBox>
						<mx:HRule width="100%"/>
						<mx:VBox paddingTop="7" paddingBottom="10">
							<mx:HBox left="16" width="100%">
								<mx:Label  width="150" text="{i18n._('GLOBAL_REPORT_FORMAT')}" fontWeight="bold" fontSize="14"/>
								<mx:RadioButton id="portraitRadio" value="Portrait" label="{i18n._('GLOBAL_PORTRAIT')}" groupName="pdfSize" />
								<mx:RadioButton id="landScapeRadio" value="Landscape" label="{i18n._('GLOBAL_LANDSCAPE')}" groupName="pdfSize" />
							</mx:HBox>
						</mx:VBox>
					</mx:VBox>
				</mx:Canvas>	
				<mx:Canvas width="100%"  label="{i18n._('PREFERENCES_LABEL_TEXT_OPTIONS')}">
					<mx:VBox left="16" width="100%">
						<mx:HBox>							
							<mx:VBox paddingTop="10" width="100%">
								<mx:CheckBox id="editableList" label="{i18n._('PREFERENCES_CHECKBOX_LABEL_ENABLE_LIST_EDITION')}" selected="{preferences.editableList==1? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="showDebug" label="{i18n._('PREFERENCES_CHECKBOX_LABEL_SHOW_DEBUG_WINDOW')}" selected="{preferences.showDebug==1? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="showPredefinedFilters" label="{i18n._('PREFERENCES_CHECKBOX_LABEL_SHOW_PREDEFINED_FILTERS')}" selected="{Database.preferencesDao.getValue('predefined_filters')==1? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="windowResize" label="{i18n._('Window resize( 1.024x600 )')}" selected="{Database.preferencesDao.getBooleanValue('window_resize')}" change="{editStatus = true;}" />								
								<mx:CheckBox id="startAtLogin" label="Start at login" selected="{Database.preferencesDao.getBooleanValue('start_at_login')}" change="{editStatus = true;}" />
								<mx:CheckBox id="googleOpt" label="Enable Google" selected="{Database.preferencesDao.getBooleanValue('enable_google_calendar')==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkEnableFeed" label="Enable Feed" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_FEED)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkFavorite" label="Enable Favorite Filter" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_FAVORITE)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkImportant" label="Enable Important Filter" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_IMPORTANT)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="hideTechUser" label="{i18n._('Hide SSO Tech. User')}" selected="{Database.preferencesDao.isHideSSOTechUser()}" change="{editStatus = true;}" click="hideSSOTechUser(hideTechUser.selected)" />
								<mx:CheckBox id="chkHomeTask" label="{i18n._('GLOBAL_ENABLE_HOME_TASK')}" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_HOME_TASK)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkFacebook" label="Enable Facebook" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_FACEBOOK)==1?true:false}" change="{editStatus=true}"/>
								<mx:CheckBox id="chkLinkedin" label="Enable Linkedin" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_LINKEDIN)==1?true:false}" change="{editStatus=true}"/>
								<mx:CheckBox id="chkAppUpdate" label="Enable Application Update" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_APPLICATION_UPDATE)==1?true:false}" change="{editStatus=true}"/>
							</mx:VBox>
							<mx:VBox paddingTop="10" width="100%">
								<mx:CheckBox id="exchangeOpt" label="Enable Microsoft Exchange" selected="{Database.preferencesDao.getBooleanValue('ms_exchange_enable')}" change="{editStatus = true;}" />
								<mx:CheckBox id="netbreezeOpt" label="{i18n._('PREFERENCES_CHECKBOX_LABEL_ENABLE_NETBREEZE')}" selected="{Database.preferencesDao.getValue('netbreeze_tab')==1? true:false}" change="{editStatus = true;}" />
								<!--<mx:CheckBox id="googleCalendarOpt" label="{i18n._('Enable Google Calendar')}" selected="{Database.preferencesDao.getValue('enable_google_calendar')==1? true:false}" change="{editStatus = true;}" />-->
								<mx:CheckBox id="usegzip" label="Use HTTP Compression" selected="{Database.preferencesDao.getBooleanValue('usegzip')}" change="{editStatus = true;}" />
								<mx:CheckBox id="enable_check_conflict" label="Enable Check Conflict" selected="{Database.preferencesDao.getBooleanValue('enable_check_conflict')}" change="{editStatus = true;}" />
								<mx:HBox width="100%">
									<mx:Label  text="{i18n._('CSV Separator')}"/>
									<mx:ComboBox id="cboSeparator" dataProvider="{dataSeparator}" width="60"/>
								</mx:HBox>
								<mx:HBox width="100%">
									<mx:CheckBox id="logFile" label="{i18n._('PREFERENCES_CHECKBOX_LOG_FILE')}" selected="{Database.preferencesDao.getValue('log_files')==1? true:false}" change="{editStatus = true;logFileName.enabled=logFile.selected}" />
									<!--CRO 05.01.2011 PREFERENCES_TEXT_INPUT_FILE_NAME = GLOBAL_FILENAME-->
									<mx:TextInput id="logFileName" toolTip="{i18n._('GLOBAL_FILENAME')}" enabled="{logFile.selected}" text="{Database.preferencesDao.getValue('log_fileName')}"/>
								</mx:HBox>
								<mx:HBox width="100%">
									<mx:Button label="{i18n._('Initialize New DB')}" click="{initializeNewDB_clickHandler()}"/>
								</mx:HBox>	
								<mx:HBox width="100%">
									<mx:ComboBox id="important_length" enabled="{chkImportant.selected}" dataProvider="{dataImportant}" width="100"/>
								</mx:HBox>
								
								<mx:HBox width="100%">
									<mx:Label  text="{i18n._('Recent Filter(in days)')}"/>
									<mx:ComboBox id="recent_filter"  dataProvider="{dataRecentFilter}" width="60"/>
								</mx:HBox>
								<mx:CheckBox id="chkFuzzy" label="{i18n._('GLOBAL_ENABLE_FUZZY')}" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_FUZZY)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkConvertLead" label="{i18n._('GLOBAL_ENABLE_CONVERT_LEAD')}" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_CONVERT_LAED)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkDashboard" label="{i18n._('GLOBAL_ENABLE_DASHBOARD')}" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_DASHBOARD)==1 ? true:false}" change="{editStatus = true;}" />
								<mx:CheckBox id="chkDailyAgenda" label="{i18n._('GLOBAL_ENABLE_DAILY_AGENDA')}" selected="{Database.preferencesDao.getBooleanValue(PreferencesDAO.ENABLE_DAILY_AGENDA)==1 ? true:false}" change="{editStatus = true;}" />
							</mx:VBox>
						</mx:HBox>
					</mx:VBox>
				</mx:Canvas>
				
				<mx:Canvas width="100%" label="{i18n._('PREFERENCES_CANVAS_LABEL_AUTO_CONFIGURATION')}">
					<mx:VBox width="100%">
						<mx:Form width="100%">
							<mx:FormItem label="{i18n._('PREFERENCES_FORMITEM_LABEL_CONFIGURATION_URL')}">
								<mx:TextInput id="configurl" width="360" text="{preferences.config_url}"/>
							</mx:FormItem>
						</mx:Form>
						<mx:Canvas width="100%">
							<mx:Button left="240" bottom="16" id="loadConfigurationBtn" label="{i18n._('PREFERENCES_BUTTON_LABEL_LOAD_CONFIGURATION')}" click="loadConfiguration();"/>
							
						</mx:Canvas>
					</mx:VBox>
					
				</mx:Canvas>
				
				<!-- idex 5,6  to 6,7  -->
				<mx:Canvas label="{i18n._('PREFERENCES_CANVAS_LABEL_NETBREEZE')}" width="100%" height="100%" id="netBreeze">
					<mx:VBox width="100%">
						<mx:Form width="100%">
							<!--CRO 05.01.2011-->
							<mx:FormItem label="{i18n._('GLOBAL_LOGIN')}">
								<mx:TextInput id="sodloginNetbreeze" width="360" text="{preferences.sodlogin}"/>
							</mx:FormItem>
							<mx:FormItem label="{i18n._('PREFERENCES_FORMITEM_LABEL_NETBREEZE_USERID')}">
								<mx:TextInput id="NetbreezeUserId" width="360" editable="false" text="188_dynamics_t1"/>
							</mx:FormItem>
						</mx:Form>
						<mx:Canvas width="100%">
							<mx:Button left="240" bottom="16" id="createNetbreeze" label="{i18n._('PREFERENCES_BUTTON_LABEL_CREATE_NETBREEZE_ACCOUNT')}" click="createNetbreeze_clickHandler(event)"/>
						</mx:Canvas>
					</mx:VBox>
				</mx:Canvas>
				<!--
				<mx:Canvas width="100%" label="User Sign">
				<control:EpadSign id="epadPanel" height="200" width="380"
				/>
				</mx:Canvas>
				-->
				<!--GMAIL LOGIN FORM-->
				<mx:Canvas id="googleCalendar" width="100%" label="{i18n._('Google Calendar')}">
					<mx:VBox width="100%">
						<mx:Form width="100%">
							<mx:FormItem label="{i18n._('Username')}">
								<mx:TextInput id="txtGmailUsername" width="360" text="{preferences.gmail_username}"/>
							</mx:FormItem>
							<mx:FormItem label="{i18n._('Password')}">
								<mx:TextInput displayAsPassword="true" id="txtGmailPassword" width="360" text="{preferences.gmail_password}"/>
							</mx:FormItem>
						</mx:Form>
						<mx:HBox width="100%" horizontalAlign="center">
							<mx:Button id="testGmailConnectionBtn" label="{i18n._('Test connection')}" click="testGmailConnection()"/>
							<control:CustomLinkButton id="testGmailConnectionWait" icon="{ImageUtils.synOkIcon}" label="" visible="false" includeInLayout="false"/>
						</mx:HBox>
					</mx:VBox>
				</mx:Canvas>			
				
				<!--Feed Setting-->
				<mx:Canvas id="feedSetting" width="100%" label="{i18n._('Feed Setting')}">
					<mx:HBox width="90%" left="16">						
						<mx:VBox width="45%" id="enabledFeeds"/>
						
						<mx:VRule height="100%"/>
						
						<mx:VBox width="45%" left="16">
							<mx:Label text="Feed Server Setup" fontWeight="bold"/>
							<mx:Form width="100%">
								<mx:FormItem label="Server URL:">
									<mx:TextInput id="txtFeedURL" width="280" text="{preferences.feed_url}"/>
								</mx:FormItem> 
								<mx:FormItem label="Server Port:">
									<mx:TextInput id="txtFeedPort" width="280" text="{preferences.feed_port}"/>
								</mx:FormItem>
							</mx:Form>
							
							<mx:Image id="imgPreviewAvatar" width="50" height="50"/>
							<mx:HBox horizontalGap="20">
								<mx:Button id="btnSetAvatar" label="Set user's avatar" click="btnSetAvatar_clickHandler(event)"/>
								<mx:Button id="btnGetAvatar" label="Refresh following's avatar" click="btnGetAvatar_clickHandler(event)"/>
							</mx:HBox>
							<mx:HBox width="100%">
								<mx:Label text="{i18n._('Delete Feed History')}"/>
								<mx:ComboBox id="cboFeedHistory" dataProvider="{dataFeedHistory}" width="85"/>
							</mx:HBox>
							
						</mx:VBox>
						
					</mx:HBox>
				</mx:Canvas>
				
				<!-- (vm) Tab Microsoft Exchange -->
				<mx:Canvas id="microsoftExchange" label="{i18n._('Exchange Server')}" width="100%" height="100%">
					<mx:VBox width="100%">
						<mx:Form width="100%">
							<!--vm 03.05.2011-->
							<mx:FormItem label="{i18n._('URL')}">
								<mx:TextInput id="ms_url" width="360" text="{preferences.ms_url}"/>
							</mx:FormItem>
							<mx:FormItem label="{i18n._('GLOBAL_LOGIN')}">
								<mx:TextInput id="ms_user" width="360" text="{preferences.ms_user}"/>
							</mx:FormItem>
							<mx:FormItem label="{i18n._('GLOBAL_PASSWORD')}">
								<mx:TextInput displayAsPassword="true" id="ms_pwd" width="360" text="{preferences.ms_password}"/>
							</mx:FormItem>
						</mx:Form>
						
					</mx:VBox>
				</mx:Canvas>
				<mx:Canvas width="100%" label="Custom Setting Export">
					<mx:Label text="Setting Export:" top="30" left="50" fontWeight="bold" fontSize="16"/>
					<mx:VBox width="100%" height="100%" top="90" left="100">
						<mx:Label text="Layout Export:" top="80" left="50" fontWeight="bold"/>
						<mx:CheckBox id="chkCustLayout"  label="Custom Layout" selected="{preferences.enable_custom_layout==1? true:false}"/>
						<mx:CheckBox id="chkListLayout" label="List Layout" selected="{preferences.enable_list_layout==1? true:false}"/>
						<mx:CheckBox id="chkViewLayout" label="View Layout" selected="{preferences.enable_view_layout==1? true:false}"/>
						<mx:CheckBox id="chkFilterLayout" label="Filter" selected="{preferences.enable_filter==1? true:false}"/>
						<mx:Label text="Preferences Export:" top="80" left="50" fontWeight="bold" />
						<mx:CheckBox id="chkConnection"  label="Connection Informations" selected="{preferences.enable_connection_information==1? true:false}"/>
						<mx:CheckBox id="chkEnableTransaction" label="Enable Transaction" selected="{preferences.enable_transaction==1? true:false}"/>
						<mx:CheckBox id="chkUserInterface" label="User Interface" selected="{preferences.enable_user_interface==1? true:false}"/>
						<mx:CheckBox id="chkOption" label="Option" selected="{preferences.enable_option==1? true:false}"/>
						<mx:CheckBox id="chkAutoConfict" label="Auto-Configuration" selected="{preferences.enable_auto_configuration==1? true:false}"/>
					</mx:VBox>
					
				</mx:Canvas>
				
				<mx:Canvas id="recportAdmin" width="100%" height="100%" label="TCS Report Admin">
					<mx:Form width="100%" height="100%">
						<mx:FormItem label="Report to path:">
							<mx:HBox id="browser">
								<mx:TextInput id="txtPath" width="365" click="browserForOpen()"/>
								<mx:Button label="..." click="browserForOpen()" />
							</mx:HBox>
						</mx:FormItem> 
						<mx:FormItem label="Auditor:">
							<mx:TextInput id="auditor" width="365" text=""/>
						</mx:FormItem>
						<mx:FormItem label="Type:">
							<mx:TextInput id="txtType" width="365" text=""/>
						</mx:FormItem>
						<mx:FormItem label="From(s):" width="100%" height="100%">
							<mx:VBox width="100%" height="100%">								
								<mx:DataGrid width="100%" height="100%" itemEditEnd="itemEditEnd(event);" dataProvider="{_dataProviderReportAdmin}" editable="true">
									<mx:columns>
										<mx:DataGridColumn dataField="report_name" headerText="Report Name" />
										<mx:DataGridColumn dataField="report_code" headerText="Report Code" />
									</mx:columns> 
								</mx:DataGrid>
							</mx:VBox>
						</mx:FormItem>
					</mx:Form>
				</mx:Canvas>
			</mx:TabNavigator>
			<mx:HBox width="100%">
				<mx:HBox width="100%" height="100%" paddingTop="8" id="buttonsconfigure">
					<mx:LinkButton icon="@Embed(source='/assets/save_config.png')" toolTip="{i18n._('PREFERENCES_LINKBUTTON_TOOLTIP_EXPORT_CONFIGURATION')}" click="exportPref()" />
					<mx:LinkButton icon="@Embed(source='/assets/upload_config.png')" toolTip="{i18n._('PREFERENCES_LINKBUTTON_TOOLTIP_IMPORT_CONFIGURATION')}" click="importPref()" />
					<mx:Label text="" id="showStatus" />
				</mx:HBox>
				<mx:HBox width="100%">
					<!--<mx:ButtonBar id="buttonbardetail" />-->
					<control:DetailButtonBar id="buttonbardetail" buttonLabel="PREFERENCES_DETAILBUTTONBAR_BUTTONLABEL_SAVE_CHANGES" action="save"/>
				</mx:HBox>
			</mx:HBox>
		</mx:VBox>
	</mx:Canvas>
	<MyValidate:URLValidator id="crmondemandURLValidator" required="true" source="{sodhost}" property="text"/>
	
	<mx:NumberValidator id="feedPortValidator" source="{txtFeedPort}" property="text" integerError="Enter Integer value" domain="int"/> 
	
</mx:Window>
